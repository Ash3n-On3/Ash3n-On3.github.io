<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hook Framework</title>
      <link href="2021/03/15/Hook%E6%A1%86%E6%9E%B6/"/>
      <url>2021/03/15/Hook%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p>æˆªè·æ¶ˆæ¯ï¼Œè·å¾—æ§åˆ¶æƒã€‚<span id="more"></span></p><p>HOOKæ¡†æ¶æ˜¯ä¸€ç§Androidé€†å‘æŠ€æœ¯ã€‚åœ¨ç³»ç»Ÿæ²¡æœ‰è°ƒç”¨è¯¥å‡½æ•°ä¹‹å‰ï¼ŒHookå°±å…ˆæ•è·è¯¥æ¶ˆæ¯ï¼ŒHookå‡½æ•°å…ˆå¾—åˆ°æ§åˆ¶æƒï¼Œè¿™æ—¶Hookå‡½æ•°æ—¢å¯ä»¥ä¿®æ”¹ç¨‹åºæ‰§è¡Œé€»è¾‘ï¼Œæ”¹å˜å‚æ•°è¿”å›å€¼ï¼Œè¿˜å¯ä»¥å¼ºåˆ¶ç»“æŸæ¶ˆæ¯çš„ä¼ é€’ã€‚æœ¬æ–‡ä»‹ç»å¸¸ç”¨çš„ä¸¤ç§ã€‚</p><h1 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h1><p>Fridaæ˜¯åŸºäºJavaScriptå’Œpythonçš„ï¼Œå¯ä»¥å®ç°å¯¹androidç¨‹åºè¿›è¡ŒåŠ¨æ€è°ƒè¯•çš„å·¥å…·åŒ…ï¼Œå¯ä»¥ç”¨äºä¸‹åˆ—ç”¨é€”ï¼š</p><ul><li>è®¿é—®è¿›ç¨‹çš„å†…å­˜</li><li>åº”ç”¨ç¨‹åºè¿è¡Œæ—¶è¦†ç›–åŠŸèƒ½</li><li>ä»å¯¼å…¥çš„ç±»è°ƒç”¨å‡½æ•°</li><li>åŠ¨æ€Hookè·Ÿè¸ªã€æ‹¦æˆªå‡½æ•°</li><li>åœ¨å †ä¸ŠæŸ¥æ‰¾å¯¹è±¡å®ä¾‹å¹¶ä½¿ç”¨è¿™äº›å¯¹è±¡å®ä¾‹</li></ul><p>Fridaçš„æœ¬è´¨æ˜¯ç»™äºŒè¿›åˆ¶æ–‡ä»¶æ’æ¡©ï¼Œç”¨å®‰å“åº”ç”¨ä¸¾ä¾‹ï¼šåœ¨æ‰‹æœºä¸Šè¿è¡Œfrida_serverå¹¶ä¸”è½¬å‘ç«¯å£åˆ°PCç«¯ï¼ŒPCç«¯åˆåˆ©ç”¨pythonä»£ç ä¸serverè¿›è¡Œé€šä¿¡ï¼Œå¹¶ç”¨JavaScriptå¯¹äºæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹è¿›è¡Œæ³¨å…¥ï¼Œè¾¾åˆ°å†…å­˜è®¿é—®çš„ç›®çš„ã€‚å¦‚å›¾ï¼š</p><img src="https://z3.ax1x.com/2021/03/25/6LUVsI.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUVsI.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 67%;" /><p>æœ¬æ–‡å¯¹ç¤ºä¾‹çš„ä¸¤ä¸ªapkåˆ†åˆ«è¿›è¡Œjavaå±‚å’Œnativeå±‚çš„hookè°ƒè¯•ã€‚</p><h2 id="Javaå±‚"><a href="#Javaå±‚" class="headerlink" title="Javaå±‚"></a>Javaå±‚</h2><h3 id="1-æ‰‹æœºç«¯ç¯å¢ƒé…ç½®"><a href="#1-æ‰‹æœºç«¯ç¯å¢ƒé…ç½®" class="headerlink" title="1.æ‰‹æœºç«¯ç¯å¢ƒé…ç½®"></a>1.æ‰‹æœºç«¯ç¯å¢ƒé…ç½®</h3><ul><li>ä¸‹è½½<a href="https://github.com/frida/frida/releases">frida_server</a>å¹¶pushè‡³æ‰‹æœºä¸­</li><li>adb shellä¸­è¿è¡Œï¼Œå¹¶è½¬å‘ç«¯å£(é»˜è®¤ç«¯å£ä¸º27042)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:27042 tcp:27042</span><br></pre></td></tr></table></figure><h3 id="2-Java-ä»£ç åˆ†æ"><a href="#2-Java-ä»£ç åˆ†æ" class="headerlink" title="2.Java ä»£ç åˆ†æ"></a>2.Java ä»£ç åˆ†æ</h3><p>demoä¸­éœ€è¦åˆ†æçš„ä»£ç æ®µå¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//In MainActivity:</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg6)</span> </span>&#123;</span><br><span class="line"><span class="keyword">switch</span>(arg6.getId()) &#123;</span><br><span class="line"><span class="comment">//Button 1</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2131230720</span>: &#123;</span><br><span class="line">      Toast.makeText(<span class="keyword">this</span>.getApplication(), <span class="keyword">new</span> StringBuilder(String.valueOf(Utils.getCalc(<span class="number">2000</span>, <span class="number">5000</span>))).toString(), <span class="number">1</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//Button 2</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2131230721</span>: &#123;</span><br><span class="line">      Toast.makeText(<span class="keyword">this</span>.getApplication(), Utils.getMoney().getInfo(), <span class="number">1</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//Button 3</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2131230722</span>: &#123;</span><br><span class="line">      Toast.makeText(<span class="keyword">this</span>.getApplication(), Utils.test(<span class="number">0x7CB8</span>), <span class="number">1</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//Button 4</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2131230723</span>: &#123;</span><br><span class="line">      Toast.makeText(<span class="keyword">this</span>.getApplication(), Utils.test(), <span class="number">1</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//Button 5</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2131230724</span>: &#123;</span><br><span class="line">      Toast.makeText(<span class="keyword">this</span>.getApplication(), Utils.test(), <span class="number">1</span>).show();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­äº”ä¸ªButtonåˆ†åˆ«å¯¹åº”äº†å¦‚ä¸‹äº”ç§å‡½æ•°ç±»å‹ã€‚å…¶Javaä»£ç åŠJavaScriptæ³¨å…¥è„šæœ¬å¦‚ä¸‹ï¼š</p><p><strong>Button 1:æ™®é€šæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCalc</span><span class="params">(<span class="keyword">int</span> arg1, <span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg1 + arg2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‡</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//é€šè¿‡Java.use()æ‰¾åˆ°éœ€è¦hookçš„javaç±»ä¸ºå˜é‡åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&#x27;com.frida.test.Utils&#x27;</span>);</span><br><span class="line"><span class="comment">//ä¸ºutilç±»ä¸­çš„getCalcæ–¹æ³•ç¼–å†™hookè„šæœ¬ï¼šå‚æ•°ä¸ºa,b</span></span><br><span class="line">    utils.getCalc.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="comment">//logæ–¹å¼è¾“å‡º</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Hook Start...&quot;</span>);</span><br><span class="line"><span class="comment">//ç»ˆç«¯æ–¹å¼è¾“å‡ºï¼Œåˆ†åˆ«è¾“å‡ºJavaå±‚ä¸­ç»™getCalcå‡½æ•°ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">send(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    send(<span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">send(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> num=<span class="built_in">arguments</span>[<span class="number">0</span>]+<span class="built_in">arguments</span>[<span class="number">1</span>];</span><br><span class="line">send(<span class="string">&quot;è¿”å›å€¼:&quot;</span>);</span><br><span class="line">send(num);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.getCalc(<span class="built_in">arguments</span>[<span class="number">0</span>],<span class="built_in">arguments</span>[<span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Button 2:æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Money</span><span class="params">(<span class="keyword">int</span> arg1, String arg2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.num = arg1;</span><br><span class="line">    <span class="keyword">this</span>.name = arg2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‡</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> money = Java.use(<span class="string">&#x27;com.frida.test.Money&#x27;</span>);</span><br><span class="line"><span class="comment">//&quot;$init&quot;è¡¨ç¤ºmoneyç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    money.$init.implementation = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Hook Start...&quot;</span>);</span><br><span class="line">send(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">send(<span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">    send(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line"><span class="comment">//åŸä¼ å…¥å‚æ•°ä¸º:100,&quot;RMB&quot;</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.$init(<span class="number">10000</span>, <span class="string">&quot;Dollor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Button 3:é‡è½½æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">test</span><span class="params">(<span class="keyword">int</span> arg2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Test string 2:&quot;</span> + arg2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;This is a test string&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ğŸ‘‡</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> utils = Java.use(<span class="string">&#x27;com.frida.test.Utils&#x27;</span>);</span><br><span class="line"><span class="comment">//ç»‘å®šå‚æ•°ç±»å‹ä¸º(int)çš„testé‡è½½å‡½æ•°</span></span><br><span class="line">    utils.test.overload(<span class="string">&quot;int&quot;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Hook Start...&quot;</span>);</span><br><span class="line">send(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    send(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;3.1415926&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Button4ã€5</strong>åœ¨javaå±‚ä¸­è°ƒç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;This is a test string&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é€šè¿‡æ³¨å…¥ä¸åŒçš„Javascripè„šæœ¬å®ç°å¦‚ä¸‹çš„ä¸åŒåŠŸèƒ½ã€‚</p><p><strong>æ„é€ å¯¹è±¡å‚æ•°</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//æ­¤å¤„æ„é€ ä¸¤ä¸ªæ–°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> utils = Java.use(<span class="string">&#x27;com.frida.test.Utils&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> money = Java.use(<span class="string">&#x27;com.frida.test.Money&#x27;</span>);</span><br><span class="line"><span class="comment">//testå‡½æ•°ä½œä¸ºè½½ä½“</span></span><br><span class="line">  utils.test.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    send(<span class="string">&quot;Hook Start...&quot;</span>);</span><br><span class="line"><span class="comment">//åŠ«æŒç¨‹åºæ‰§è¡Œæ–°å¯¹è±¡çš„æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">var</span> mon = money.$new(<span class="number">2000</span>,<span class="string">&#x27;æ¸¯å¸&#x27;</span>);</span><br><span class="line">send(mon.getInfo());</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.test(<span class="number">800</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹å¯¹è±¡å±æ€§</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> utils = Java.use(<span class="string">&#x27;com.frida.test.Utils&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> money = Java.use(<span class="string">&#x27;com.frida.test.Money&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="class"><span class="keyword">class</span> </span>= Java.use(<span class="string">&#x27;java.lang.Class&#x27;</span>);</span><br><span class="line">  utils.test.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  send(<span class="string">&quot;Hook Start...&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> mon = money.$new(<span class="number">200</span>,<span class="string">&#x27;æ¸¯å¸&#x27;</span>);</span><br><span class="line">send(mon.getInfo());</span><br><span class="line"><span class="comment">//å°†å˜é‡ç»‘å®šä¸ºmoneyå¯¹è±¡çš„numå±æ€§</span></span><br><span class="line"><span class="keyword">var</span> numid= Java.cast(mon.getClass(),<span class="class"><span class="keyword">class</span>).<span class="title">getDeclaredField</span>(&#x27;<span class="title">num</span>&#x27;)</span>;</span><br><span class="line"><span class="comment">//å°†å˜é‡è®¾ä¸ºå¯ä¿®æ”¹</span></span><br><span class="line">numid.setAccessible(<span class="literal">true</span>);</span><br><span class="line">  send(numid.get(mon));</span><br><span class="line"><span class="comment">//ä¿®æ”¹</span></span><br><span class="line">  numid.setInt(mon, <span class="number">1000</span>);</span><br><span class="line">  send(mon.getInfo());</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.test(<span class="number">800</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°JavaScriptè„šæœ¬å‡éœ€è¦æ’å…¥åˆ°pythonä»£ç ä¸­ä»¥è¿è¡Œä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">jscode=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ­¤å¤„æ’å…¥jsä»£ç ï¼Œç”¨ä¸‰å¼•å·åŒ…å›´</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message</span>(<span class="params">message, data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line">process = frida.get_remote_device().attach(<span class="string">&#x27;com.frida.test&#x27;</span>)</span><br><span class="line">script= process.create_script(jscode)</span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>, message)</span><br><span class="line">script.load()</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><h2 id="Nativeå±‚"><a href="#Nativeå±‚" class="headerlink" title="Nativeå±‚"></a>Nativeå±‚</h2><p>soå±‚ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall Java_com_example_fridaso_FridaSoDefine_FridaSo(<span class="built_in">int</span> a1, <span class="built_in">int</span> a2, <span class="built_in">int</span> a3, <span class="built_in">int</span> a4ï¼Œ<span class="built_in">int</span> a5)</span><br><span class="line">&#123;</span><br><span class="line">switch(a5):</span><br><span class="line">case <span class="number">1</span>:</span><br><span class="line">  <span class="keyword">return</span> a4 + a3;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">case <span class="number">1</span>:</span><br><span class="line">  <span class="keyword">return</span> a3 - a4;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">case <span class="number">1</span>:</span><br><span class="line">  <span class="keyword">return</span> a4 * a3;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">case <span class="number">1</span>:</span><br><span class="line">  <span class="keyword">return</span> a3 / a4;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">default:</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Javascriptè„šæœ¬ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setImmediateåŒ…å›´ï¼Œå¯é˜²æ­¢è¶…æ—¶æŠ¥é”™</span></span><br><span class="line">setImmediate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    send(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†æ¨¡å—æ‰¾åŸºå€</span></span><br><span class="line">    Process.enumerateModules(&#123;</span><br><span class="line">        onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">exp</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (exp.name == <span class="string">&#x27;libdemo.so&#x27;</span>) &#123;</span><br><span class="line">                send(<span class="string">&#x27;enumerateModules find&#x27;</span>);</span><br><span class="line">                send(exp.name + <span class="string">&quot;|&quot;</span> + exp.base + <span class="string">&quot;|&quot;</span> + exp.size + <span class="string">&quot;|&quot;</span> + exp.path);</span><br><span class="line">                send(exp);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;stop&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            send(<span class="string">&#x27;enumerateModules stop&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//hookå¯¼å‡ºå‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">exports</span> = Module.enumerateExportsSync(<span class="string">&quot;libdemo.so&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="built_in">exports</span>.length;i++)&#123;</span><br><span class="line">        send(<span class="string">&quot;name:&quot;</span>+<span class="built_in">exports</span>[i].name+<span class="string">&quot;  address:&quot;</span>+<span class="built_in">exports</span>[i].address);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//é€šè¿‡æ¨¡å—åç›´æ¥æŸ¥æ‰¾åŸºå€</span></span><br><span class="line">    <span class="keyword">var</span> baseSOFile = Module.findBaseAddress(<span class="string">&quot;libdemo.so&quot;</span>);</span><br><span class="line">    <span class="comment">//&quot;Interceptor.attach&quot;è·å–è¿›ç¨‹ï¼Œæ­¤å¤„è‹¥ä¸ºthumbæ±‡ç¼–åˆ™éœ€è¦æ”¹æˆ0x1270+1</span></span><br><span class="line">    Interceptor.attach(baseSOFile.add(<span class="number">0x00001270</span>),&#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line"><span class="comment">//å‚æ•°1ä¸ºJNIEnv *</span></span><br><span class="line">            <span class="built_in">console</span>.log(Memory.readCString(args[<span class="number">0</span>]));</span><br><span class="line"><span class="comment">//å‚æ•°2ä¸ºjclass</span></span><br><span class="line">            <span class="built_in">console</span>.log(Memory.readUtf16String(args[<span class="number">3</span>]));</span><br><span class="line">            <span class="built_in">console</span>.log(args[<span class="number">2</span>]);</span><br><span class="line">            <span class="built_in">console</span>.log(args[<span class="number">3</span>]);</span><br><span class="line">            <span class="built_in">console</span>.log(args[<span class="number">4</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡åŒ…åç±»åå‡½æ•°åæ‰¾åˆ°åŸºå€è·å–ç¨‹åºè¿›ç¨‹</span></span><br><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">&quot;libfridaso.so&quot;</span>,<span class="string">&quot;Java_com_example_fridaso_FridaSoDefine_FridaSo&quot;</span>),&#123;</span><br><span class="line">        <span class="comment">//onEnteråœ¨å‡½æ•°æ‰§è¡Œå‰æ‰§è¡Œï¼Œargsæ˜¯å‡½å‚</span></span><br><span class="line">onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            send(<span class="string">&quot;Hook start&quot;</span>);</span><br><span class="line">            send(<span class="string">&quot;args[2]=&quot;</span> + args[<span class="number">2</span>]);</span><br><span class="line">            send(<span class="string">&quot;args[3]=&quot;</span> + args[<span class="number">3</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="comment">//onLeaveåœ¨å‡½æ•°æ‰§è¡Œç»“æŸåæ‰§è¡Œï¼Œretvalæ˜¯è¿”å›å€¼</span></span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>)</span>&#123;</span><br><span class="line">            send(<span class="string">&quot;return:&quot;</span>+retval); </span><br><span class="line">            retval.replace(<span class="number">0</span>); <span class="comment">//æ›¿æ¢è¿”å›å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Xposed-Framework"><a href="#Xposed-Framework" class="headerlink" title="Xposed Framework"></a>Xposed Framework</h1><h2 id="åŸç†ç®€è¿°"><a href="#åŸç†ç®€è¿°" class="headerlink" title="åŸç†ç®€è¿°"></a><strong>åŸç†ç®€è¿°</strong></h2><p>Xposedæ¡†æ¶é€šè¿‡å®‰è£…æ¨¡å—æ¥å®ç°éœ€è¦çš„åŠŸèƒ½ã€‚æ‰€è°“æ¨¡å—æ˜¯æŒ‡ä¸€ç±»ç‰¹æ®Šçš„appï¼Œæ­¤ç±»appé€šè¿‡ä¿®æ”¹Zygoteæ¥å®ç°ä¸€äº›è®¾è®¡å†…æ ¸ä»¥åŠé«˜æƒé™çš„åŠŸèƒ½ï¼Œç”±Xposedç®¡ç†ã€‚å…¶ä¸­ï¼ŒZygoteæ˜¯Androidçš„å†…æ ¸ï¼Œæ¯ä¸ªAPPå‡ç”±Zygote forkå‡ºçš„è™šæ‹Ÿæœºæ¥è¿è¡Œï¼Œè€ŒXposedæ¡†æ¶ä¸­çš„æ¨¡å—å¯ä»¥é‡å†™å¹¶æ›¿æ¢Zygoteçš„æ‰§è¡Œæ–‡ä»¶app_processï¼Œå³å¯ä»ä¸€å¼€å§‹å°±ä¿®æ”¹æ•´ä¸ªè¿›ç¨‹ã€‚</p><p>è¯¦ç»†åŸç†å‚è§<a href="https://www.freebuf.com/articles/terminal/56453.html">é“¾æ¥</a>ã€‚</p><h2 id="ä½¿ç”¨è¿‡ç¨‹"><a href="#ä½¿ç”¨è¿‡ç¨‹" class="headerlink" title="ä½¿ç”¨è¿‡ç¨‹"></a>ä½¿ç”¨è¿‡ç¨‹</h2><h3 id="æ‰‹æœºç«¯"><a href="#æ‰‹æœºç«¯" class="headerlink" title="æ‰‹æœºç«¯"></a>æ‰‹æœºç«¯</h3><p>1.æ‰‹æœºrootåç›´æ¥å®‰è£…<a href="http://xposed.appkg.com/nav">xpose installer</a> ï¼Œéœ€è¦æ³¨æ„android5.0ä»¥ä¸‹å’Œä»¥ä¸Šå®‰è£…çš„æ˜¯ä¸åŒç‰ˆæœ¬ã€‚</p><p>2.é‡å¯åæç¤ºå®‰è£…å®Œæˆ</p><p><img src="https://z3.ax1x.com/2021/03/25/6LUZLt.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUZLt.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="PCç«¯"><a href="#PCç«¯" class="headerlink" title="PCç«¯"></a>PCç«¯</h3><p>1.åœ¨Android Studioä¸­æ–°å»ºç©ºç™½å·¥ç¨‹(No Activity)ï¼Œå°†åº“æ–‡ä»¶æ‹–å…¥libsç›®å½•ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LUpdK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUpdK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>2.åœ¨Javaé¡¹ç›®çš„ç¬¬ä¸€ä¸ªåŒ…é‡Œæ–°å»ºclassã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LUPiD.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUPiD.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xp;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hook</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(loadPackageParam.packageName.equals(<span class="string">&quot;åŒ…å&quot;</span>))&#123;</span><br><span class="line">      XposedHelpers.findAndHookMethod(<span class="string">&quot;åŒ…å.ç±»å&quot;</span>, loadPackageParam.classLoader,</span><br><span class="line">        <span class="string">&quot;hookå‡½æ•°å&quot;</span>, String.class, String.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line"><span class="comment">//æ‰§è¡Œè¢«hookå‡½æ•°å‰è¿è¡Œ</span></span><br><span class="line">          <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">            XposedBridge.log(<span class="string">&quot;Arg1: &quot;</span> + param.args[<span class="number">0</span>]);</span><br><span class="line">            XposedBridge.log(<span class="string">&quot;Arg2: &quot;</span> + param.args[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//XposedBridge.log(&quot;Arg3: &quot; + param.args[2]);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°å †æ ˆä¿¡æ¯</span></span><br><span class="line">            StackTraceElement[] wodelogs = <span class="keyword">new</span> Throwable(<span class="string">&quot;wodelog&quot;</span>).getStackTrace();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;wodelogs.length;i++)&#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;æŸ¥çœ‹å †æ ˆ:&quot;</span>+wodelogs[i].toString());</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line"><span class="comment">//æ‰§è¡Œè¢«hookå‡½æ•°åè¿è¡Œ(è¿”å›å‰)</span></span><br><span class="line">          <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">XposedBridge.log(<span class="string">&quot;Result before modified: &quot;</span> + param);</span><br><span class="line">            param.setResult(<span class="keyword">true</span>); <span class="comment">// å‡½æ•°è¿”å›å€¼ä¿®æ”¹ä¸ºtrue</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.åˆ›å»ºassetsæ–‡ä»¶å¤¹ï¼Œæ–°å»ºæ–‡ä»¶xposed_initï¼Œå†™å…¥â€œåŒ…å+ç±»åâ€ï¼Œæ¨¡å—ä»æ­¤å¤„å¯»æ‰¾ç¨‹åºå…¥å£ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LU9IO.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LU9IO.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>4.ä¿®æ”¹æ¸…å•æ–‡ä»¶AndroidManifest.xmlï¼Œåœ¨<application>æ ‡ç­¾ä¹‹é—´æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ·»åŠ æ ‡è¯† --&gt;</span></span><br><span class="line"> &lt;meta-data</span><br><span class="line">     android:name=&quot;xposedmodule&quot;</span><br><span class="line">     android:value=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- è½½å…¥Hookæ¨¡å—ä¹‹åæ˜¾ç¤ºçš„ä¿¡æ¯ --&gt;</span></span><br><span class="line"> &lt;meta-data</span><br><span class="line">     android:name=&quot;xposeddescription&quot;</span><br><span class="line">     android:value=&quot;Xposed Proxy For HOOK&quot;/&gt;</span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- è§„å®šjaråŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ --&gt;</span></span><br><span class="line"> &lt;meta-data</span><br><span class="line">     android:name=&quot;xposedminversion&quot;</span><br><span class="line">     android:value=&quot;54&quot;/&gt;</span><br></pre></td></tr></table></figure><p>ğŸ‘‡</p><img src="https://z3.ax1x.com/2021/03/25/6LUiJe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUiJe.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:80%;" /><p>5.ä¿®æ”¹build.gradle(app)ï¼Œæ·»åŠ sourceSetsæ®µè½ï¼Œä¿®æ”¹fileTreeä¸ºcompileOnly</p><img src="https://z3.ax1x.com/2021/03/25/6LUFRH.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUFRH.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:67%;" /><p>6.æ„é€ è¿è¡Œï¼Œåœ¨è™šæ‹Ÿæœºä¸­æŸ¥çœ‹ï¼Œåœ¨installerä¸­å‹¾é€‰æ¨¡å—</p><p><img src="https://z3.ax1x.com/2021/03/25/6LUkzd.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUkzd.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>7.é‡å¯ååœ¨installerä¸­æŸ¥çœ‹æ—¥å¿—ï¼Œå®‰è£…å®Œæˆ</p><p><img src="https://z3.ax1x.com/2021/03/25/6LUEQA.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LUEQA.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android Protection</title>
      <link href="2021/03/08/Android%20Protection/"/>
      <url>2021/03/08/Android%20Protection/</url>
      
        <content type="html"><![CDATA[<p>å…³äºAPKåŒ…çš„ä¿æŠ¤ä»¥åŠä»£ç çš„åè°ƒè¯•æ–¹æ³•ã€‚<span id="more"></span></p><h1 id="APKä¿æŠ¤"><a href="#APKä¿æŠ¤" class="headerlink" title="APKä¿æŠ¤"></a>APKä¿æŠ¤</h1><h2 id="Javaä»£ç æ··æ·†"><a href="#Javaä»£ç æ··æ·†" class="headerlink" title="Javaä»£ç æ··æ·†"></a>Javaä»£ç æ··æ·†</h2><p>é€šå¸¸ä¸ºäº†æé«˜ä»£ç å¯è¯»æ€§ï¼Œå¼€å‘è€…ä¼šç»™å„ä¸ªæ ‡è¯†èµ‹äºˆç›¸åº”çš„æ„ä¹‰ï¼ŒåŒ…åç±»åéƒ½ä¼šç»è¿‡ç›¸åº”çš„å‘½åã€‚ä½†æ˜¯å½“ç¨‹åºè¢«æ‰“åŒ…æ—¶ï¼Œä¸éœ€è¦è€ƒè™‘å¯è¯»æ€§ï¼Œå› ä¸ºåŒ…åç±»åæˆ–è€…æ ‡è¯†ç¬¦åªéœ€è¦èƒ½å‡†ç¡®å¯»å€å³å¯ï¼Œäºæ˜¯å¼€å‘è€…ä¼šå¯¹å¯æ‰§è¡Œæ–‡ä»¶çš„æºä»£ç è¿›è¡Œæ··æ·†ï¼Œè¿™æ ·å¯ä»¥ä¸€å®šç¨‹åº¦çš„å¢åŠ é€†å‘è¿‡ç¨‹ä¸­æ‰€éœ€çš„æ—¶é—´ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LYZLV.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LYZLV.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>ä½å¯è¯»æ€§å¯ä»¥åŠé€€ä¸€éƒ¨åˆ†é€†å‘è€…ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ•´ä¸ªä»£ç çš„é€»è¾‘å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå› æ­¤å¹¶ä¸èƒ½ä¸€åŠ³æ°¸é€¸åœ°è§£å†³ä»£ç ä¿æŠ¤çš„é—®é¢˜ã€‚</p><h2 id="èµ„æºæ–‡ä»¶æ··æ·†"><a href="#èµ„æºæ–‡ä»¶æ··æ·†" class="headerlink" title="èµ„æºæ–‡ä»¶æ··æ·†"></a>èµ„æºæ–‡ä»¶æ··æ·†</h2><p>ç±»ä¼¼ä»£ç æ··æ·†ï¼Œé™ä½èµ„æºidå’Œèµ„æºæ–‡ä»¶åçš„å¯è¯»æ€§ã€‚</p><h2 id="ç­¾åéªŒè¯"><a href="#ç­¾åéªŒè¯" class="headerlink" title="ç­¾åéªŒè¯"></a>ç­¾åéªŒè¯</h2><p>æŸäº›apkæ–‡ä»¶è§£å‹åï¼Œå‘ç°é‡Œé¢å­˜åœ¨MANIFEST.MFæ–‡ä»¶ï¼Œè¿™å°±æ˜¯apkçš„ç­¾åæ–‡ä»¶ã€‚</p><p>ç­¾åæ–‡ä»¶ä¸­ä¿å­˜ç€apkæ–‡ä»¶çš„ä¿¡æ¯æ‘˜è¦å¹¶è¿›è¡Œäº†åŠ å¯†ï¼Œå¦‚æœé€šè¿‡é€†å‘å¯¹apkè¿›è¡Œé‡æ–°æ‰“åŒ…ï¼Œä¼šä½¿å¾—ç­¾åæ–‡ä»¶ä¸åŸæ–‡ä»¶ä¸ä¸€è‡´ï¼Œæ— æ³•é€šè¿‡ç­¾åæ ¡éªŒã€‚</p><p>ç­¾åéªŒè¯æ–¹å¼å¾ˆå¤šï¼Œä»¥ä¸‹ä¾‹å­æ˜¯è¢«å®šä¹‰åœ¨nativeå±‚çš„ä¸‰ä¸ªç­¾åç›¸å…³å‡½æ•°ï¼Œäººé€çˆ±ç§°â€œç­¾åä¸‰å…„å¼Ÿâ€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getPackageName()</span><br><span class="line">getPackageManage()</span><br><span class="line">getPackageInfo()</span><br></pre></td></tr></table></figure><p>ç­¾åéªŒè¯å¯ä»¥é€šè¿‡ä¿®æ”¹ç¨‹åºé€»è¾‘è¿›è¡Œç»•è¿‡ï¼Œå®é™…æƒ…å†µå®é™…åˆ†æã€‚</p><h1 id="åè°ƒè¯•"><a href="#åè°ƒè¯•" class="headerlink" title="åè°ƒè¯•"></a>åè°ƒè¯•</h1><h2 id="å…³é”®æ–‡ä»¶æ£€æµ‹"><a href="#å…³é”®æ–‡ä»¶æ£€æµ‹" class="headerlink" title="å…³é”®æ–‡ä»¶æ£€æµ‹"></a>å…³é”®æ–‡ä»¶æ£€æµ‹</h2><p>éå†**/data/local/tmp<strong>è·¯å¾„ï¼ŒæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨</strong>android_server<strong>ï¼Œ</strong>android_server64**è¿™æ ·çš„æ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨åˆ™æ€æ­»å½“å‰è¿›ç¨‹ã€‚</p><h2 id="è°ƒè¯•ç«¯å£æ£€æµ‹"><a href="#è°ƒè¯•ç«¯å£æ£€æµ‹" class="headerlink" title="è°ƒè¯•ç«¯å£æ£€æµ‹"></a>è°ƒè¯•ç«¯å£æ£€æµ‹</h2><p>ä¸€äº›è°ƒè¯•å™¨åœ¨è°ƒè¯•å®‰å“ç¨‹åºæ—¶ä¼šå ç”¨é»˜è®¤çš„ç«¯å£ï¼Œä¾‹å¦‚IDAä½¿ç”¨çš„ç«¯å£ï¼š<strong>23946</strong>ã€‚æ£€éªŒå ç”¨è¿™äº›ç«¯å£çš„è¿›ç¨‹å³å¯è½»æ˜“åˆ¤æ–­ç¨‹åºæ˜¯å¦è¢«è°ƒè¯•ã€‚</p><p>ä½†æ¢æˆéé»˜è®¤ç«¯å£å³å¯ç»•è¿‡ã€‚</p><h2 id="è¿›ç¨‹åç§°æ£€æµ‹"><a href="#è¿›ç¨‹åç§°æ£€æµ‹" class="headerlink" title="è¿›ç¨‹åç§°æ£€æµ‹"></a>è¿›ç¨‹åç§°æ£€æµ‹</h2><p>Androidç³»ç»Ÿä¸­(å…¶å®Linuxä¹Ÿæ˜¯)ï¼Œæ¯ä¸ªè¿›ç¨‹è¿è¡Œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œè·¯å¾„ä¸º**/proc/pid/<strong>ï¼Œå…¶<a href="https://blog.csdn.net/zdwzzu2006/article/details/7747977">ç›®å½•</a>ä¸‹çš„</strong>status**æ–‡ä»¶ç”¨äºè®°å½•è¿›ç¨‹çŠ¶æ€ã€‚è€Œstatusæ–‡ä»¶ä¸­çš„Traceridå­—æ®µï¼Œåˆç”¨äºè®°å½•å½“å‰è¿›ç¨‹çš„è°ƒè¯•è¿›ç¨‹pidã€‚</p><p>æ£€æµ‹æ—¶åªéœ€è¯»å–æ­¤å¤„çš„pidåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºå†æŸ¥è¯¢æ­¤pidå¯¹åº”çš„æ˜¯ä»€ä¹ˆè¿›ç¨‹ã€‚å¦‚æœæ˜¯android_serverè¿™æ ·çš„ä¸è°ƒè¯•ç›¸å…³è¿›ç¨‹ï¼Œåˆ™ç›´æ¥æ€æ­»å½“å‰è¿›ç¨‹é˜»æ­¢è°ƒè¯•ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">coursecheck</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> bufsize = <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">char</span> filename[bufsize];</span><br><span class="line">    <span class="keyword">char</span> line[bufsize];</span><br><span class="line">    <span class="keyword">char</span> name[bufsize];</span><br><span class="line">    <span class="keyword">char</span> nameline[bufsize];</span><br><span class="line">    <span class="keyword">int</span> pid = getpid();</span><br><span class="line">    <span class="comment">//å…ˆè¯»å–Tracepidçš„å€¼</span></span><br><span class="line">    <span class="built_in">sprintf</span>(filename, <span class="string">&quot;/proc/%d/status&quot;</span>, pid);</span><br><span class="line">    FILE *fd=fopen(filename,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(fd!=<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">while</span>(fgets(line,bufsize,fd))</span><br><span class="line">&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strstr</span>(line,<span class="string">&quot;TracerPid&quot;</span>)!=<span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> statue =atoi(&amp;line[<span class="number">10</span>]);</span><br><span class="line">                <span class="keyword">if</span>(statue!=<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">                    <span class="built_in">sprintf</span>(name,<span class="string">&quot;/proc/%d/cmdline&quot;</span>,statue);</span><br><span class="line">                    FILE *fdname=fopen(name,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>(fdname!= <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">                        <span class="keyword">while</span>(fgets(nameline,bufsize,fdname))</span><br><span class="line">&#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="built_in">strstr</span>(nameline,<span class="string">&quot;android_server&quot;</span>)!=<span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">                                <span class="keyword">int</span> ret=kill(pid,SIGKILL);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    fclose(fdname);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è½®è¯¢æ£€æµ‹"><a href="#è½®è¯¢æ£€æµ‹" class="headerlink" title="è½®è¯¢æ£€æµ‹"></a>è½®è¯¢æ£€æµ‹</h2><p>å¾ªç¯æ£€æµ‹å½“å‰è¿›ç¨‹çŠ¶æ€æ–‡ä»¶ï¼Œå³ ï¼Œåˆ¤æ–­traceridå­—æ®µæ˜¯å¦ä¸º0ï¼Œè‹¥ä¸ä¸º0åˆ™åˆ¤å®šè¿›ç¨‹å¤„äºè¢«debugçŠ¶æ€ï¼Œè¿›è€Œå…³é—­è¿›ç¨‹ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LtCm6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LtCm6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="Self-Debugging"><a href="#Self-Debugging" class="headerlink" title="Self-Debugging"></a>Self-Debugging</h2><p>å½“å‰è¿›ç¨‹fork()å¾—åˆ°å­è¿›ç¨‹åï¼Œå­è¿›ç¨‹å¯¹çˆ¶è¿›ç¨‹è¿›è¡Œdebugï¼Œç”±äºçˆ¶è¿›ç¨‹è¢«å ç”¨(è¿›ç¨‹åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹attach)ï¼Œä½¿å¾—å…¶ä»–ç¨‹åºæ— æ³•ç›´æ¥å¯¹çˆ¶è¿›ç¨‹è¿›è¡Œdebugã€‚</p><p>è§£å†³æ–¹æ³•ï¼šé€šè¿‡debugå­è¿›ç¨‹æ¥é—´æ¥debugçˆ¶è¿›ç¨‹ã€‚</p><h2 id="æ¨¡æ‹Ÿå™¨æ£€æµ‹"><a href="#æ¨¡æ‹Ÿå™¨æ£€æµ‹" class="headerlink" title="æ¨¡æ‹Ÿå™¨æ£€æµ‹"></a>æ¨¡æ‹Ÿå™¨æ£€æµ‹</h2><p>æ ¹æ®æ¨¡æ‹Ÿå™¨çš„ç‰¹å¾ï¼Œç¨‹åºå¯ä»¥åˆ¤æ–­è‡ªèº«æ˜¯å¦è¿è¡Œäºæ¨¡æ‹Ÿå™¨ä¸­ã€‚ç‰¹å¾å€¼å¤§è‡´æœ‰ä¸‹é¢è¿™äº›ï¼š</p><ol><li>Device ID - è®¾å¤‡åºåˆ—å·</li><li>ç”µè¯å·ç </li><li>IMSIè¯†åˆ«ç </li><li>è¿è¥å•†åç§°</li><li>QEMUç›¸å…³çš„äºŒè¿›åˆ¶æ–‡ä»¶</li><li>CPUä¿¡æ¯</li></ol><p>é™¤æ­¤ä¹‹å¤–çš„<a href="https://bbs.pediy.com/thread-225717.html">æ¨¡æ‹Ÿå™¨æ£€æµ‹æ–¹æ³•</a>è¿˜æœ‰å¾ˆå¤šã€‚</p><h2 id="Javaå±‚åè°ƒè¯•"><a href="#Javaå±‚åè°ƒè¯•" class="headerlink" title="Javaå±‚åè°ƒè¯•"></a>Javaå±‚åè°ƒè¯•</h2><h3 id="0x00-Debugæ¡ä»¶"><a href="#0x00-Debugæ¡ä»¶" class="headerlink" title="0x00.Debugæ¡ä»¶"></a>0x00.Debugæ¡ä»¶</h3><ul><li><p>apkä¸­çš„AndroidMainfest.xmlä¸­ï¼Œapplicationæ ‡ç­¾ä¸‹æœ‰è¯¥å±æ€§ï¼š</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Android:debuggable=true</span><br></pre></td></tr></table></figure></li><li><p>è®¾å¤‡å¯è°ƒè¯•ï¼Œå³æ‹¥æœ‰å¦‚ä¸‹å±æ€§ï¼š</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ro.debugable=1</span><br></pre></td></tr></table></figure><p>  è¯¥å±æ€§åˆä½äºboot.imgé•œåƒä¸­çš„/default.propæ–‡ä»¶ä¸­ï¼Œå‰è€…åœ¨è®¾å¤‡å¼€æœºå‰ç”±ramdisk æŒ‚è½½ã€‚å› æ­¤å¯ä»¥ä¿®æ”¹boot.imgä»è€Œä¿®æ”¹ro.debugableå±æ€§ä½¿å¾—è®¾å¤‡å…¨å±€å¯è°ƒè¯•ã€‚<a href="https://www.cnblogs.com/codex/p/12250647.html">è¯¥é¡¹ä¿®æ”¹</a>å¯é€šè¿‡MagiskåŠå…¶æ¨¡å—MagiskHide Props Configå®ç°ã€‚</p></li></ul><h3 id="0x01-isDebuggerConnected"><a href="#0x01-isDebuggerConnected" class="headerlink" title="0x01.isDebuggerConnected()"></a>0x01.isDebuggerConnected()</h3><p>Android SDKä¸­çš„android.os.debugç±»æä¾›äº†ä¸€ä¸ªisDebuggerConnectedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­JDWPè°ƒè¯•å™¨æ˜¯å¦æ­£åœ¨å·¥ä½œã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LYmZT.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LYmZT.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>å¯é€šè¿‡ä¿®æ”¹smaliä»£ç è¿›è¡Œç»•è¿‡ã€‚</p><h3 id="0x02-æ—¶é—´æˆ³æ£€æµ‹"><a href="#0x02-æ—¶é—´æˆ³æ£€æµ‹" class="headerlink" title="0x02.æ—¶é—´æˆ³æ£€æµ‹"></a>0x02.æ—¶é—´æˆ³æ£€æµ‹</h3><p>æ­£å¸¸æƒ…å†µä¸‹ç¨‹åºè¿è¡Œæ—¶å–ä¸¤ä¸ªæ—¶é—´æˆ³ï¼Œä¸¤è€…å·®å€¼è¾ƒå°ã€‚ä½†è‹¥æ˜¯åœ¨debugçŠ¶æ€ä¸‹ï¼Œæ—¶é—´å·®å€¼ä¼šè¶…å‡ºæ­£å¸¸å€¼ï¼Œè‹¥æ’é™¤ç¨‹åºå¡é¡¿å·²ç»bugçš„æƒ…å†µä¸‹å¯ä»¥æ–­å®šappå¤„äºdebugçŠ¶æ€ã€‚Expï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jint <span class="title">anti_time</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> pid = getpid();</span><br><span class="line"> struct timeval t1;</span><br><span class="line"> struct timeval t2;</span><br><span class="line"> struct timezone tz;</span><br><span class="line"> gettimeofday(&amp;t1, &amp;tz);</span><br><span class="line"> gettimeofday(&amp;t2, &amp;tz);</span><br><span class="line"> <span class="keyword">int</span> timeoff = (t2.tv_sec) - (t1.tv_sec);</span><br><span class="line"> LOGD(<span class="string">&quot;time %d&quot;</span>,timeoff);</span><br><span class="line"> <span class="keyword">if</span> (timeoff &gt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> ret = kill(pid, SIGKILL);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="0x03-æ–­ç‚¹æ£€æµ‹"><a href="#0x03-æ–­ç‚¹æ£€æµ‹" class="headerlink" title="0x03.æ–­ç‚¹æ£€æµ‹"></a>0x03.æ–­ç‚¹æ£€æµ‹</h3><p>ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¼šå°†elfæ–‡ä»¶(ä½¿ç”¨soçš„æƒ…å†µä¸‹)å¯¼å…¥å¯¼å…¥å†…å­˜ä¸­ï¼Œå¦‚æœå­˜åœ¨æ–­ç‚¹ï¼Œå†…å­˜ä¸­ä¹Ÿä¼šæ”¹å˜ç›¸åº”çš„æŒ‡ä»¤ï¼Œç•™ä¸‹thumbæˆ–è€…armçš„æ–­ç‚¹æŒ‡ä»¤çš„æœºå™¨ç ã€‚åˆ©ç”¨æŒ‡é’ˆéå†å†…å­˜ä¸­elfæ–‡ä»¶åˆ¤æ–­æœ‰æ— ä¸Šè¿°æœºå™¨ç ï¼Œå³å¯åˆ¤æ–­æœ‰æ— æ–­ç‚¹ï¼Œè¿›è€Œåˆ¤æ–­æ˜¯å¦å¤„äºdebugã€‚Expï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jint <span class="title">anti_breakpoint</span><span class="params">()</span></span>&#123;</span><br><span class="line">Elf32_Ehdr *elfhdr;</span><br><span class="line">Elf32_Phdr *pht;</span><br><span class="line">unsigned <span class="keyword">int</span> size, base, offset,phtable;</span><br><span class="line"><span class="keyword">int</span> n, i,j;</span><br><span class="line"><span class="keyword">char</span> *p;</span><br><span class="line"><span class="comment">//ä»mapsä¸­è¯»å–elfæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€</span></span><br><span class="line">base = GetLibAddr();</span><br><span class="line"><span class="keyword">if</span>(base == <span class="number">0</span>)&#123;</span><br><span class="line">LOGD(<span class="string">&quot;find base error/n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">elfhdr = (Elf32_Ehdr *) base;</span><br><span class="line">phtable = elfhdr-&gt;e_phoff + base;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;elfhdr-&gt;e_phnum;i++)&#123;</span><br><span class="line">pht = (Elf32_Phdr*)(phtable+i*sizeof(Elf32_Phdr));</span><br><span class="line">    <span class="keyword">if</span>(pht-&gt;p_flags&amp;<span class="number">1</span>)&#123;</span><br><span class="line">    offset = pht-&gt;p_vaddr + base + sizeof(Elf32_Ehdr) + sizeof(Elf32_Phdr)*elfhdr-&gt;e_phnum;</span><br><span class="line">        LOGD(<span class="string">&quot;offset:%#x ,len:%#x&quot;</span>,offset,pht-&gt;p_memsz);</span><br><span class="line">        p = (<span class="keyword">char</span>*)offset;</span><br><span class="line">        size = pht-&gt;p_memsz;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>,n=<span class="number">0</span>;j&lt;size;++j,++p)&#123;</span><br><span class="line">        <span class="keyword">if</span>(*p == <span class="number">0x10</span> &amp;&amp; *(p+<span class="number">1</span>) == <span class="number">0xde</span>)&#123;</span><br><span class="line">        n++;</span><br><span class="line">                LOGD(<span class="string">&quot;### find thumb bpt %#x /n&quot;</span>,p);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(*p == <span class="number">0xf0</span> &amp;&amp; *(p+<span class="number">1</span>) == <span class="number">0xf7</span> &amp;&amp; *(p+<span class="number">2</span>) == <span class="number">0x00</span> &amp;&amp; *(p+<span class="number">3</span>) == <span class="number">0xa0</span>)&#123;</span><br><span class="line">                n++;</span><br><span class="line">                LOGD(<span class="string">&quot;### find thumb2 bpt %#x /n&quot;</span>,p);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(*p == <span class="number">0x01</span> &amp;&amp; *(p+<span class="number">1</span>) == <span class="number">0x00</span> &amp;&amp; *(p+<span class="number">2</span>) == <span class="number">0x9f</span> &amp;&amp; *(p+<span class="number">3</span>) == <span class="number">0xef</span>)&#123;</span><br><span class="line">                n++;</span><br><span class="line">                LOGD(<span class="string">&quot;### find arm bpt %#x /n&quot;</span>,p);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        LOGD(<span class="string">&quot;### find breakpoint num: %d/n&quot;</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apk åŠ¨è°ƒ</title>
      <link href="2021/03/01/APK%E5%8A%A8%E8%B0%83/"/>
      <url>2021/03/01/APK%E5%8A%A8%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<p>Javaå±‚ä¸Nativeå±‚çš„åŠ¨è°ƒè°ƒè¯•ã€‚<span id="more"></span></p><h1 id="DDMS-javaå±‚"><a href="#DDMS-javaå±‚" class="headerlink" title="DDMS(javaå±‚)"></a>DDMS(javaå±‚)</h1><h2 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h2><img src="https://z3.ax1x.com/2021/03/25/6L8TOK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8TOK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 47%;" /><h2 id="æ’æ¡©-logè¾“å‡º"><a href="#æ’æ¡©-logè¾“å‡º" class="headerlink" title="æ’æ¡©-logè¾“å‡º"></a>æ’æ¡©-logè¾“å‡º</h2><ol><li>åˆ©ç”¨AndroidKillerä¿®æ”¹apkåŒ…ï¼Œåœ¨éœ€è¦æ’æ¡©çš„ä»£ç å¤„å³é”®logè¾“å‡ºï¼Œå¡«å…¥è°ƒè¯•æ—¶éœ€è¦è¾“å‡ºçš„å­—ç¬¦ä¸²ã€‚</li><li>æ‰“åŒ…å®‰è£…åˆ°è®¾å¤‡ã€‚</li><li>ddmsä¸­æ‰¾åˆ°ç¨‹åºå¯¹åº”çš„activityï¼Œè¿‡æ»¤æ‰¾åˆ°è¾“å‡ºä¿¡æ¯ã€‚</li><li>æ ¹æ®è¾“å‡ºä¿¡æ¯çš„æ—¶é—´æˆ³æ‰¾åˆ°ä¸Šä¸‹æ–‡ï¼Œå¾—åˆ°æ–¹æ³•è°ƒç”¨å±‚æ¬¡ã€‚</li></ol><h2 id="æ ˆè·Ÿè¸ª-stacktrace"><a href="#æ ˆè·Ÿè¸ª-stacktrace" class="headerlink" title="æ ˆè·Ÿè¸ª-stacktrace"></a>æ ˆè·Ÿè¸ª-stacktrace</h2><ol><li>åˆ©ç”¨AndroidKillerä¿®æ”¹apkåŒ…ï¼Œåœ¨éœ€è¦æ’æ¡©å¤„å³é”®stacktraceï¼Œå¡«å…¥è°ƒè¯•æ—¶éœ€è¦è¾“å‡ºçš„å­—ç¬¦ä¸²ã€‚</li><li>å®‰è£…æ‰“å¼€ï¼Œç”¨ddmsè¿‡æ»¤è¾“å‡ºä¿¡æ¯ã€‚</li><li>æ ¹æ®è¾“å‡ºä¿¡æ¯çš„æ—¶é—´æˆ³æ‰¾åˆ°ä¸Šä¸‹æ–‡ï¼Œè‡ªä¸‹è€Œä¸Šå¾—åˆ°æ–¹æ³•è°ƒç”¨å±‚æ¬¡ã€‚</li></ol><img src="https://z3.ax1x.com/2021/03/25/6L85S1.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L85S1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 67%;" /><h2 id="æ–¹æ³•åˆ†æ"><a href="#æ–¹æ³•åˆ†æ" class="headerlink" title="æ–¹æ³•åˆ†æ"></a>æ–¹æ³•åˆ†æ</h2><ol><li>DDMSå¤„æ‰“å¼€æ–¹æ³•åˆ†æå¹¶é™åˆ¶åˆ†æçš„æ–¹æ³•æ•°ã€‚</li><li>ç‚¹å‡»okåï¼Œç«‹å³åœ¨è®¾å¤‡ä¸Šå®ç°éœ€è¦åˆ†æçš„åŠŸèƒ½ã€‚</li><li>åŠŸèƒ½å®ç°åç«‹å³ç‚¹å‡»åœæ­¢æ–¹æ³•åˆ†æã€‚</li><li>ç­‰å¾…æ–¹æ³•åˆ†æçª—å£æ‰“å¼€ã€‚</li><li>ä»»æ„æ–¹æ³•å‡å¯é€šè¿‡ä¸‹æ‹‰é¡¹æŸ¥çœ‹ä¸Šå±‚(parents)å’Œä¸‹å±‚(Children)çš„è°ƒç”¨æ–¹æ³•ã€‚</li></ol><p><img src="https://z3.ax1x.com/2021/03/25/6L8IQx.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8IQx.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 43%;" /><img src="https://z3.ax1x.com/2021/03/25/6L8oy6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8oy6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 58%;" /></p><h1 id="Android-Studio-Smalide-javaå±‚"><a href="#Android-Studio-Smalide-javaå±‚" class="headerlink" title="Android Studio + Smalide(javaå±‚)"></a>Android Studio + Smalide(javaå±‚)</h1><h2 id="è¿œç¨‹è°ƒè¯•"><a href="#è¿œç¨‹è°ƒè¯•" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h2><ol><li>åœ¨AndroidKillerä¸­æ‰“å¼€apkæ–‡ä»¶ï¼Œç”¨ASå¯¼å…¥è¯¥å·¥ç¨‹æ–‡ä»¶å¤¹</li><li>åœ¨smaliæ–‡ä»¶ä¸­è®¾ç½®è°ƒè¯•æ–­ç‚¹</li><li>åœ¨â€œè¿è¡Œ-ç¼–è¾‘é…ç½®â€ä¸­æ–°å»ºâ€œremoteâ€ç±»å‹é…ç½®ï¼Œè®¾ç½®å¥½è°ƒè¯•å™¨åç§°å’Œç«¯å£</li><li>è¿æ¥è®¾å¤‡ï¼Œæ‰“å¼€éœ€è¦è°ƒè¯•çš„ç¨‹åºï¼Œç”¨â€œadb shell psâ€å‘½ä»¤æ‰¾åˆ°éœ€è¦è°ƒè¯•çš„è¿›ç¨‹</li><li>ç”¨â€œadb forward tcp:10001 jdwp:3523â€å‘½ä»¤è¿œç¨‹è¿æ¥ï¼Œå…¶ä¸­â€tcp:â€åå¡«å…¥è°ƒè¯•ç«¯å£å·ï¼Œâ€jdwpâ€åå¡«å…¥éœ€è¦è°ƒè¯•è¿›ç¨‹çš„pid</li><li>åœ¨å·¥å…·æ å¤„é€‰æ‹©è¿œç¨‹è°ƒè¯•é…ç½®ï¼Œç‚¹å‡»çˆ¬è™«iconè¿›è¡Œè°ƒè¯•</li></ol><p><img src="https://z3.ax1x.com/2021/03/25/6L8HeO.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8HeO.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><img src="https://z3.ax1x.com/2021/03/25/6L8bwD.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8bwD.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:47%;" /><h1 id="IDA-Pro-Nativeå±‚"><a href="#IDA-Pro-Nativeå±‚" class="headerlink" title="IDA Pro(Nativeå±‚)"></a>IDA Pro(Nativeå±‚)</h1><h2 id="è¿œç¨‹è°ƒè¯•-1"><a href="#è¿œç¨‹è°ƒè¯•-1" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h2><p>å°†android_server(64) pushåˆ°è®¾å¤‡ä¸­ï¼Œchmodèµ‹äºˆæƒé™å¹¶è¿è¡Œã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L8qTe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8qTe.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>åœ¨terminalä¸­ç”¨adbè¿›è¡Œç«¯å£è½¬å‘ã€‚é»˜è®¤ç«¯å£<strong>23946</strong>ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L82o4.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L82o4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>åˆ©ç”¨å‘½ä»¤ä½¿ç¨‹åºæŒ‚èµ·ï¼Œæ­¤æ—¶å¯åœ¨è®¾å¤‡ä¸­çœ‹è§â€œWarnningâ€çª—å£ã€‚</p><blockquote><p>adb shell am start -D -n åŒ…å/åŒ…å+ç±»å</p></blockquote><img src="https://z3.ax1x.com/2021/03/25/6L8gwF.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8gwF.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:67%;" /><p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/81bf07f6-3978-4d13-aa30-7b76c868192d/Screenshot_20210317-170013.png" class="lazyload" data-srcset="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/81bf07f6-3978-4d13-aa30-7b76c868192d/Screenshot_20210317-170013.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/81bf07f6-3978-4d13-aa30-7b76c868192d/Screenshot_20210317-170013.png"></p><p>æ‰“å¼€ddmså¯ä»¥å‘ç°è¢«æŒ‚èµ·çš„è¿›ç¨‹åä¹‹å‰å‡ºç°çº¢è™«è™«ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L8yLT.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8yLT.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>æ‰“å¼€IDAè¿›è¡Œattachï¼Œé€‰æ‹©è¿›ç¨‹ï¼Œè¿›å…¥è°ƒè¯•çª—å£ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L8ceU.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8ceU.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://z3.ax1x.com/2021/03/25/6L8syV.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8syV.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>å‹¾é€‰ä¸‰ä¸ªè°ƒè¯•å™¨é€‰é¡¹ï¼ˆç¨‹åºå…¥å£ç‚¹ï¼Œçº¿ç¨‹å¯åŠ¨ç»ˆæ­¢ï¼Œåº“åŠ è½½å¸è½½ï¼‰ï¼ŒF9è¿è¡Œï¼Œæ­¤æ—¶æ ‡é¢˜æ˜¾ç¤ºâ€œrunningâ€ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L8WFJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8WFJ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>é‡Šæ”¾ç¨‹åºï¼Œæ­¤æ—¶åœ¨ddmsä¸­å‘ç°çº¢è™«è™«å˜ç»¿è™«è™«ï¼Œæ­¤æ—¶ç¨‹åºä¸­çš„æç¤ºçª—å£æ¶ˆå¤±ï¼Œç¨‹åºæ­£å¸¸è¿è¡Œã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6L8fY9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8fY9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>åœ¨IDAçš„æ¨¡å—çª—å£æœç´¢ï¼Œè‹¥æœªå‘ç°ç›®æ ‡åº“åˆ™ç»§ç»­è¿è¡Œï¼Œéšåå³å¯å‘ç°ç›®æ ‡åº“è¢«åŠ è½½åˆ°IDAï¼Œå¼€å§‹è°ƒè¯•ã€‚</p><img src="https://z3.ax1x.com/2021/03/25/6L8hWR.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6L8hWR.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:50%;" /><p>Command Listï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./data/user/tmp/as</span><br><span class="line">adb forward tcp:23946 tcp:23946</span><br><span class="line">adb shell am start -D -n åŒ…å/åŒ…å+ç±»å</span><br><span class="line">jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=pid</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NDKå¼€å‘</title>
      <link href="2021/02/27/NDK%E5%BC%80%E5%8F%91/"/>
      <url>2021/02/27/NDK%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>ç”¨C/C++å¼€å‘Android<span id="more"></span></p><p>Androidå·¥ç¨‹ä¸€èˆ¬ç”±javaè¯­è¨€ç¼–å†™ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡NDKè°ƒç”¨nativeæ–¹æ³•æ¥æ‰§è¡ŒC/C++çš„ä»£ç ï¼Œåè€…ä»£ç ä¸­çš„æ ‡è¯†ç¬¦éœ€è¦åœ¨å·¥ç¨‹ä¸­è¿›è¡Œæ³¨å†Œï¼Œä»¥ä¾¿åœ¨javaè¢«ä¸€ä¸€å¯¹åº”åœ°æ‰¾åˆ°å¹¶æ­£ç¡®è°ƒç”¨ã€‚ä¸‹é¢ä»‹ç»å…³äºnativeæ–¹æ³•çš„å¼€å‘è¿‡ç¨‹ã€‚</p><h2 id="å¼€å‘æµç¨‹"><a href="#å¼€å‘æµç¨‹" class="headerlink" title="å¼€å‘æµç¨‹"></a>å¼€å‘æµç¨‹</h2><h3 id="ç¼–å†™-java"><a href="#ç¼–å†™-java" class="headerlink" title="ç¼–å†™.java"></a>ç¼–å†™.java</h3><p>åœ¨javaæ–‡ä»¶ä¸­å£°æ˜éœ€è¦ç”¨åˆ°çš„nativeå‡½æ•°ï¼Œæ— éœ€ç¼–å†™æ–¹æ³•ä½“ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LQGEd.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LQGEd.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>å£°æ˜åæ’å…¥å¦‚ä¸‹ä»£ç ï¼Œä»¥ä¾¿è¿è¡Œæ—¶åŠ è½½nativeåº“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">System.loadLibrary(<span class="string">&quot;strjni&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-h"><a href="#ç”Ÿæˆ-h" class="headerlink" title="ç”Ÿæˆ.h"></a>ç”Ÿæˆ.h</h3><p>åœ¨srcæ–‡ä»¶å¤¹è¿è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javah -jni com.example.ndktest.MainActivity</span><br></pre></td></tr></table></figure><p>åœ¨å·¥ç¨‹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹â€jniâ€ï¼Œå°†srcæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆçš„.hé‡å‘½ååç§»åŠ¨åˆ°æ­¤å¤„ã€‚</p><p><img src="https://z3.ax1x.com/2021/03/25/6LQJUA.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LQJUA.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="ç¼–å†™mkæ–‡ä»¶"><a href="#ç¼–å†™mkæ–‡ä»¶" class="headerlink" title="ç¼–å†™mkæ–‡ä»¶"></a>ç¼–å†™mkæ–‡ä»¶</h3><p>åœ¨jniæ–‡ä»¶å¤¹æ–°å»ºä¸¤ä¸ªmakefileæ–‡ä»¶ï¼Œæ­¤ç±»æ–‡ä»¶ç”¨äºæè¿°ç¼–è¯‘çš„ç›¸å…³é…ç½®ã€‚æ–‡ä»¶ååŠå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Android.mk</span></span><br><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span>   </span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(CLEAR_VARS)</span>  </span><br><span class="line">LOCAL_MODULE    := strjni  <span class="comment">#æ¨¡å—åç§°  </span></span><br><span class="line">LOCAL_SRC_FILES := strjni.c <span class="comment">#æºæ–‡ä»¶  .cæˆ–è€….cpp</span></span><br><span class="line">LOCAL_ARM_MODE := arm       <span class="comment">#ç¼–è¯‘åçš„æŒ‡ä»¤é›† ARMæŒ‡ä»¤</span></span><br><span class="line">LOCAL_LDLIBS += -llog       <span class="comment">#ä¾èµ–åº“    </span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(BUILD_SHARED_LIBRARY)</span> <span class="comment">#æŒ‡å®šç¼–è¯‘æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Application.mk</span></span><br><span class="line">APP_ABI := armeabi-v7a</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™-cï¼Œç¼–è¯‘"><a href="#ç¼–å†™-cï¼Œç¼–è¯‘" class="headerlink" title="ç¼–å†™.cï¼Œç¼–è¯‘"></a>ç¼–å†™.cï¼Œç¼–è¯‘</h3><p>æ ¹æ®.hä¸­çš„å£°æ˜ï¼Œåœ¨.cæ–‡ä»¶ä¸­ç¼–å†™nativeå‡½æ•°çš„å‡½æ•°ä½“ã€‚è¯¦ç»†ç¼–å†™åˆ†ä¸ºé™æ€æ³¨å†Œä¸åŠ¨æ€æ³¨å†Œã€‚</p><p>åœ¨jniç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ndk<span class="literal">-build</span></span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œè°ƒè¯•"><a href="#è¿è¡Œè°ƒè¯•" class="headerlink" title="è¿è¡Œè°ƒè¯•"></a>è¿è¡Œè°ƒè¯•</h3><p>æ„å»ºå·¥ç¨‹ï¼Œè¿æ¥AVDå¹¶ä¸”è¿è¡Œè°ƒè¯•ã€‚</p><h2 id="é™æ€æ³¨å†Œ"><a href="#é™æ€æ³¨å†Œ" class="headerlink" title="é™æ€æ³¨å†Œ"></a>é™æ€æ³¨å†Œ</h2><p>é€šè¿‡ JNIEXPORT å’Œ JNICALL ä¸¤ä¸ªå®å®šä¹‰å£°æ˜ï¼Œç¨‹åºåŠ è½½soæ—¶ä¼šæ ¹æ®ä¸Šé¢çš„å®å®šä¹‰å£°æ˜é“¾æ¥åˆ°å¯¹åº”çš„nativeå‡½æ•°ã€‚</p><h3 id="Expï¼š"><a href="#Expï¼š" class="headerlink" title="Expï¼š"></a>Expï¼š</h3><p>åœ¨Java codeä¸­å£°æ˜å¦‚ä¸‹å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">get_str</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">get_strstatic_str</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">get_string_from_c</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>ç”¨ <strong>javah -jni åŒ…å+ç±»å</strong>å‘½ä»¤ç”Ÿæˆå¦‚ä¸‹.hæ–‡ä»¶ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line"></span><br><span class="line">#ifndef _Included_com_example_jinstudy_MainActivity</span><br><span class="line">#define _Included_com_example_jinstudy_MainActivity</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">#endif</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_jinstudy_MainActivity</span></span><br><span class="line"><span class="comment"> * Method:    get_str</span></span><br><span class="line"><span class="comment"> * Signature: ()Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_str</span><br><span class="line">  (JNIEnv *, jobject);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_jinstudy_MainActivity</span></span><br><span class="line"><span class="comment"> * Method:    get_strstatic_str</span></span><br><span class="line"><span class="comment"> * Signature: ()Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_strstatic_str</span><br><span class="line">  (JNIEnv *, jobject);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_example_jinstudy_MainActivity</span></span><br><span class="line"><span class="comment"> * Method:    get_string_from_c</span></span><br><span class="line"><span class="comment"> * Signature: ()Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_string_from_c</span><br><span class="line">  (JNIEnv *, jobject);</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°åŸæœ¬Javaä¸­çš„Stringç±»å‹ï¼Œå˜æˆäº†Cä¸­çš„jstringç±»å‹ï¼Œè¿™æ˜¯ä¸¤ç§è¯­è¨€åœ¨æ•°æ®ç»“æ„ä¸Šçš„æ˜ å°„ã€‚è¯¦ç»†å¯¹åº”æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://z3.ax1x.com/2021/03/25/6LQY4I.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LQY4I.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>å¼•å…¥ä¸Šè¿°.hï¼Œç¼–å†™å¦‚ä¸‹.cæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;JNIstudy.h&gt;</span></span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_str_from_c</span><br><span class="line">  (JNIEnv *env, jobject obj)&#123;</span><br><span class="line"><span class="comment">//ç±»å‹è½¬æ¢ NewStringUTF(envï¼Œå­—ç¬¦ä¸²)</span></span><br><span class="line"> jstring str= (*env)-&gt;NewStringUTF(env, <span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è°ƒç”¨javaå±‚æ™®é€šå­—æ®µ</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_str</span><br><span class="line">  (JNIEnv *env, jobject obj)&#123;</span><br><span class="line"><span class="comment">//1.è·å–ç±»</span></span><br><span class="line"><span class="comment">//FindClass:ç¬¬ä¸€ä¸ªenvï¼Œç¬¬äºŒä¸ªï¼šå­—æ®µæ‰€åœ¨ç±»çš„è·¯å¾„ï¼ˆç‚¹æ¢æˆæ–œæ ï¼‰</span></span><br><span class="line">jclass    _jclass = (*env)-&gt;FindClass(env,<span class="string">&quot;com/example/jinstudy/MainActivity&quot;</span>);</span><br><span class="line"><span class="comment">//2.è·å–å­—æ®µID</span></span><br><span class="line"><span class="comment">//GetFieldID:ç¬¬ä¸€ä¸ªenvï¼Œç¬¬äºŒä¸ªFindClassçš„è¿”å›å€¼ï¼Œç¬¬ä¸‰ä¸ªjavaå±‚å­—æ®µçš„åç§°ï¼Œç¬¬å››ä¸ªjavaå±‚å­—æ®µçš„ç­¾å</span></span><br><span class="line"> jfieldID  _jfieldID = (*env)-&gt;GetFieldID(env, _jclass, <span class="string">&quot;ZD&quot;</span>, <span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line"> <span class="comment">//3.è·å–å­—æ®µ</span></span><br><span class="line"> <span class="comment">//GetObjectField:ç¬¬ä¸€ä¸ªenvï¼Œç¬¬äºŒä¸ªobjï¼Œç¬¬ä¸‰ä¸ªGetFieldIDçš„è¿”å›å€¼</span></span><br><span class="line"> jobject   str= (*env)-&gt;GetObjectField(env, obj, _jfieldID);</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨javaå±‚é™æ€å­—æ®µ</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_example_jinstudy_MainActivity_get_static_str</span><br><span class="line">  (JNIEnv *env, jobject obj)&#123;</span><br><span class="line"><span class="comment">//1.è·å–ç±»ï¼šFindClassï¼ˆï¼‰</span></span><br><span class="line">jclass _jclass = (*env)-&gt;FindClass(env,<span class="string">&quot;com/example/jinstudy/MainActivity&quot;</span>);</span><br><span class="line"><span class="comment">//2.è·å–é™æ€å­—æ®µID</span></span><br><span class="line">jfieldID  _jfieldID= (*env)-&gt;GetStaticFieldID(env, _jclass, <span class="string">&quot;ZD1&quot;</span>,<span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line"><span class="comment">//3.è·å–é™æ€å­—æ®µ</span></span><br><span class="line"><span class="comment">//GetStaticObjectField:ç¬¬ä¸€ä¸ªenvï¼Œç¬¬äºŒä¸ªæ˜¯ç±»,æ—¢FindClassçš„è¿”å›å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°GetStaticFieldIDçš„è¿”å›å€¼</span></span><br><span class="line">jobject  str= (*env)-&gt;GetStaticObjectField(env, _jclass, _jfieldID);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p><ol><li><p>é€šå¸¸åœ¨æˆ‘ä»¬ç¼–å†™nativeå‡½æ•°æ—¶ï¼Œæ­¤ç±»å‡½æ•°éƒ½ä¼šè‡ªå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º<em>JNIEnv *<em>å’Œ</em>jobject</em>ï¼Œç´§æ¥ç€æ‰æ˜¯è¯¥å‡½æ•°åœ¨Javaå±‚ä¸­å£°æ˜çš„å‚æ•°åˆ—è¡¨ã€‚</p></li><li><p>æˆ‘ä»¬é€šå¸¸éœ€è¦è¿”å›ä¸€ä¸ª<em>jobject</em>ç±»å‹çš„å¯¹è±¡ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°<strong>GetStaticObjectField</strong>æ–¹æ³•ï¼Œå…¶å‚æ•°åˆ†åˆ«æ˜¯<em>JNIEnv*</em>,<em>jclass,jfiledID</em>ã€‚è¿™é‡Œçš„JNIEnv<em>ä»¥åŠæœ¬èŠ‚ä¸­åæ–‡çš„JNIEnv</em>å‡å’Œnativeå‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€æ ·çš„ã€‚</p></li><li><p>jfiledIDå¯¹è±¡å°†Javaå±‚çš„å­—æ®µç±»å‹æ˜ å°„åˆ°Cä¸­ï¼Œå…¶éœ€è¦é€šè¿‡<strong>GetStaticFieldID</strong>æ–¹æ³•è·å–ï¼Œè€Œæ­¤æ–¹æ³•çš„å‚æ•°ä¸º<em>JNIEnv*</em>,<em>jclass,string,string</em>ã€‚<em>string</em>ç±»å‹çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦ä¼ å…¥çš„æ˜¯å­—æ®µåœ¨Javaå±‚ä¸­çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯è¯¥å‚æ•°çš„å®Œæ•´ç±»å‹åç§°å¹¶ä»¥â€™;â€™ç»“å°¾ã€‚</p></li><li><p>jclassåˆ™éœ€è¦ä½¿ç”¨<strong>FindClass</strong>æ–¹æ³•è·å–ï¼Œå…¶å‚æ•°ä¸º<em>JNIEnv*<em>ï¼Œ</em>string</em>ã€‚<em>string</em>ç±»å‹å‚æ•°éœ€è¦ä¼ å…¥çš„æ˜¯å‡½æ•°æ‰€åœ¨ç±»çš„è·¯å¾„åï¼Œå¯ä»¥ç†è§£æˆå°†â€™.â€™æ›¿æ¢æˆâ€™/â€˜çš„åŒ…å+ç±»åã€‚</p></li><li><p>å…¶å®é™æ€æ³¨å†Œçš„ä»£ç ç¼–å†™çš„è¦ç‚¹å°±æ˜¯ï¼Œéœ€è¦çš„è·å–ä»€ä¹ˆæ ·çš„ç±»å‹ï¼Œå°±åœ¨jni.hä¸­å¯»æ‰¾èƒ½è¿”å›è¯¥ç±»å‹çš„å¯¹åº”æ–¹æ³•ï¼Œå†è¡¥å…¨æ­¤æ–¹æ³•çš„å‚æ•°ã€‚æœ¬è´¨æ˜¯ä¸€ä¸ªé€’å½’è¡¥å…¨å‚æ•°çš„è¿‡ç¨‹ğŸ˜‚ã€‚</p></li></ol><h2 id="åŠ¨æ€æ³¨å†Œ"><a href="#åŠ¨æ€æ³¨å†Œ" class="headerlink" title="åŠ¨æ€æ³¨å†Œ"></a>åŠ¨æ€æ³¨å†Œ</h2><p>é€šè¿‡ RegisterNativeså‡½æ•°ç”±ç¼–ç¨‹è€…å®Œæˆ nativeå‡½æ•°ä¸soä¸­å‡½æ•°çš„ç»‘å®šï¼Œä½¿å¾—ç¨‹åºå¯ä»¥é€šè¿‡è¿™ä¸ªæ˜ å°„è¡¨æ‰¾åˆ°ç›¸åº”çš„å‡½æ•°äº†ã€‚</p><h3 id="Exp"><a href="#Exp" class="headerlink" title="Exp:"></a>Exp:</h3><p>åœ¨Java codeä¸­å£°æ˜å¦‚ä¸‹åŠ å‡ä¹˜é™¤å‡½æ•°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> number1,<span class="keyword">double</span> number2)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">double</span> <span class="title">sub</span><span class="params">(<span class="keyword">double</span> number1,<span class="keyword">double</span> number2)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">double</span> <span class="title">mul</span><span class="params">(<span class="keyword">double</span> number1,<span class="keyword">double</span> number2)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">double</span> <span class="title">div</span><span class="params">(<span class="keyword">double</span> number1,<span class="keyword">double</span> number2)</span></span>;</span><br></pre></td></tr></table></figure><p>å¼•å…¥jni.håç›´æ¥ç¼–å†™å¯¹åº”çš„.cæ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="function">jdouble <span class="title">addc</span><span class="params">(JNIEnv *env, jobject obj, jdouble a, jdouble b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">jdouble <span class="title">subc</span><span class="params">(JNIEnv *env, jobject obj, jdouble a, jdouble b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a-b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">jdouble <span class="title">mulc</span><span class="params">(JNIEnv *env, jobject obj, jdouble a, jdouble b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a*b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">jdouble <span class="title">divc</span><span class="params">(JNIEnv *env, jobject obj, jdouble a, jdouble b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a/b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜nativeæ–¹æ³•ç»“æ„ä½“</span></span><br><span class="line">JNINativeMethod nm[]=&#123;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼šéœ€ç»‘å®šçš„javaå±‚å‡½æ•°å,å‚æ•°è¿”å›å€¼ç±»å‹,éœ€ç»‘å®šçš„nativeå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">&#123;<span class="string">&quot;add&quot;</span>,<span class="string">&quot;(DD)D&quot;</span>,(<span class="keyword">void</span>*)addc&#125;,</span><br><span class="line">&#123;<span class="string">&quot;sub&quot;</span>,<span class="string">&quot;(DD)D&quot;</span>,(<span class="keyword">void</span>*)subc&#125;,</span><br><span class="line">&#123;<span class="string">&quot;mul&quot;</span>,<span class="string">&quot;(DD)D&quot;</span>,(<span class="keyword">void</span>*)mulc&#125;,</span><br><span class="line">&#123;<span class="string">&quot;div&quot;</span>,<span class="string">&quot;(DD)D&quot;</span>,(<span class="keyword">void</span>*)divc&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ¨æ€æ³¨å†Œ</span></span><br><span class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">JNI_OnLoad</span><span class="params">(JavaVM* vm, <span class="keyword">void</span>* reserved)</span></span>&#123;</span><br><span class="line">JNIEnv* env;</span><br><span class="line"><span class="keyword">if</span>( (*vm)-&gt;GetEnv(vm, (<span class="keyword">void</span>**)&amp;env, JNI_VERSION_1_4)!=JNI_OK)&#123;</span><br><span class="line"> <span class="keyword">return</span> JNI_ERR;</span><br><span class="line">&#125;</span><br><span class="line">jclass jc = (*env)-&gt;FindClass(env,<span class="string">&quot;com/example/calcu/MainActivity&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>((*env)-&gt;RegisterNatives(env, jc, nm,<span class="keyword">sizeof</span>(nm)/<span class="keyword">sizeof</span>(nm[<span class="number">0</span>]))!=JNI_OK)&#123;</span><br><span class="line"><span class="keyword">return</span> JNI_ERR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å›ºå®šè¿”å›å€¼</span></span><br><span class="line"><span class="keyword">return</span> JNI_VERSION_1_4;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„ï¼š</strong></p><ol><li><p>ç¼–å†™å‡½æ•°ä½“çš„è¿‡ç¨‹å’Œé™æ€æ³¨å†Œå·®å¼‚ä¸å¤§</p></li><li><p>ç”±äºæ²¡æœ‰ç”Ÿæˆ.hæ–‡ä»¶å¯¹å‡½æ•°è¿›è¡Œå£°æ˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰å‡½æ•°æ•´åˆä¸ºä¸€ä¸ª<em>JNINativeMethod</em>ç±»å‹çš„ç»“æ„ä½“ã€‚å…¶å±æ€§åˆ†åˆ«ä¸ºå‡½æ•°å†Javaå±‚ä¸­çš„å­—æ®µå(string)ï¼Œå‚æ•°å’Œè¿”å›å€¼ç±»å‹(string)ï¼Œå…¶ä¸­å‚æ•°å†™åœ¨æ‹¬å·å†…ï¼Œè¿”å›å€¼å†™åœ¨æ‹¬å·å¤–ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯Nativeæ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆ(void *)ã€‚</p></li><li><p>å¯¹ä¸Šè¿°ç»“æ„ä½“ç”¨RegisterNativesæ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œè¡¥å…¨ç›¸åº”çš„å‚æ•°åï¼Œå†™å…¥<strong>JNI_OnLoad</strong>å‡½æ•°ä½“ä¸­ï¼Œè¯¥å‡½æ•°æ˜¯åŠ¨æ€æ³¨å†Œæ˜¯Nativeæ–¹æ³•çš„å…¥å£ã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dalvikå­—èŠ‚ç </title>
      <link href="2021/02/21/Dalvik%E5%AD%97%E8%8A%82%E7%A0%81/"/>
      <url>2021/02/21/Dalvik%E5%AD%97%E8%8A%82%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>çœ‹æ‡‚Dalvikå­—èŠ‚ç ï¼Œçœ‹æ‡‚Smaliæ–‡ä»¶ã€‚<span id="more"></span></p><h2 id="å¯„å­˜å™¨"><a href="#å¯„å­˜å™¨" class="headerlink" title="å¯„å­˜å™¨"></a>å¯„å­˜å™¨</h2><p>å­˜å‚¨å˜é‡â‰¤32ä½ï¼Œç”¨1ä¸ªå¯„å­˜å™¨</p><p>å­˜å‚¨å˜é‡64ä½ï¼Œç”¨2ä¸ªç›¸é‚»å¯„å­˜å™¨</p><h2 id="å¯„å­˜å™¨å‘½åæ³•"><a href="#å¯„å­˜å™¨å‘½åæ³•" class="headerlink" title="å¯„å­˜å™¨å‘½åæ³•"></a>å¯„å­˜å™¨å‘½åæ³•</h2><h3 id="vå‘½åæ³•"><a href="#vå‘½åæ³•" class="headerlink" title="vå‘½åæ³•"></a>vå‘½åæ³•</h3><p>å±€éƒ¨å˜é‡ï¼šMä¸ª  ä½¿ç”¨å¯„å­˜å™¨ï¼šv0~vM-1</p><p>ä¼ å…¥å‚æ•°ï¼šNä¸ª  ä½¿ç”¨å¯„å­˜å™¨ï¼švM~vM+N-1</p><p><img src="https://img-blog.csdn.net/20160731141440713" class="lazyload" data-srcset="https://img-blog.csdn.net/20160731141440713" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="på‘½åæ³•"><a href="#på‘½åæ³•" class="headerlink" title="på‘½åæ³•"></a>på‘½åæ³•</h3><p>å±€éƒ¨å˜é‡ï¼šMä¸ª  ä½¿ç”¨å¯„å­˜å™¨ï¼šv0~vM-1</p><p>ä¼ å…¥å‚æ•°ï¼šNä¸ª  ä½¿ç”¨å¯„å­˜å™¨ï¼šp0~pN-1</p><p><img src="https://img-blog.csdn.net/20160731142057192" class="lazyload" data-srcset="https://img-blog.csdn.net/20160731142057192" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://z3.ax1x.com/2021/03/25/6LK2on.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LK2on.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="smaliæ•°æ®ç±»å‹"><a href="#smaliæ•°æ®ç±»å‹" class="headerlink" title="smaliæ•°æ®ç±»å‹"></a>smaliæ•°æ®ç±»å‹</h2><p><img src="https://z3.ax1x.com/2021/03/25/6LKgds.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LKgds.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="å­—æ®µä¸å‡½æ•°åˆ†æ"><a href="#å­—æ®µä¸å‡½æ•°åˆ†æ" class="headerlink" title="å­—æ®µä¸å‡½æ•°åˆ†æ"></a>å­—æ®µä¸å‡½æ•°åˆ†æ</h2><h3 id="å­—æ®µæ ¼å¼"><a href="#å­—æ®µæ ¼å¼" class="headerlink" title="å­—æ®µæ ¼å¼"></a>å­—æ®µæ ¼å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lpackage/name/ObjectName;-&gt;FieldName:Ljava/lang/String;</span><br></pre></td></tr></table></figure><p>åˆ†æä¸ºjavaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Lpackage.name</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectName</span></span>&#123;</span><br><span class="line">String FieldName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°æ ¼å¼"><a href="#å‡½æ•°æ ¼å¼" class="headerlink" title="å‡½æ•°æ ¼å¼"></a>å‡½æ•°æ ¼å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lpackage/name/ObjectName;-&gt;MethodName(III)Z</span><br></pre></td></tr></table></figure><p>åˆ†æä¸ºjavaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Lpackage.name</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjectName</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">MethodName</span><span class="params">(<span class="keyword">int</span> ,<span class="keyword">int</span> ,<span class="keyword">int</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DalvikæŒ‡ä»¤æ ¼å¼"><a href="#DalvikæŒ‡ä»¤æ ¼å¼" class="headerlink" title="DalvikæŒ‡ä»¤æ ¼å¼"></a>DalvikæŒ‡ä»¤æ ¼å¼</h2><blockquote><p>æ ¼å¼ï¼šåŸºç¡€å­—èŠ‚ç -åç§°åç¼€/å­—èŠ‚ç åç¼€  ç›®çš„å¯„å­˜å™¨  æºå¯„å­˜å™¨</p></blockquote><blockquote><p>expï¼š       move    - wide     /     from16           vAA     ,  vBBBB</p></blockquote><ul><li>å…¶ä¸­moveä¸ºåŸºç¡€å­—èŠ‚ç ï¼Œopcode</li><li>wideä¸ºåç§°åç¼€,æ ‡è¯†æŒ‡ä»¤æ“ä½œçš„æ•°æ®å®½åº¦ä¸º64ä½ã€‚</li><li>from16ä¸ºå­—èŠ‚ç åç¼€,æ ‡è¯†æºä¸ºä¸€ä¸ª16ä½çš„å¯„å­˜å™¨å¼•ç”¨å˜é‡</li><li>vAAä¸ºç›®çš„å¯„å­˜å™¨,å®ƒå§‹ç»ˆåœ¨æºçš„å‰é¢ï¼Œå–å€¼èŒƒå›´ä¸ºv0~v255</li><li>vBBBBä¸ºæºå¯„å­˜å™¨ï¼Œå–å€¼èŒƒå›´ä¸ºv0~v65535</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AndroidåŸºç¡€</title>
      <link href="2021/02/12/Android%E5%9F%BA%E7%A1%80/"/>
      <url>2021/02/12/Android%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>è¡¥å……ä¸€äº›å…³äºAndroidçš„ç³»ç»ŸçŸ¥è¯†ã€‚<span id="more"></span></p><h2 id="APKåŒ…ç»“æ„"><a href="#APKåŒ…ç»“æ„" class="headerlink" title="APKåŒ…ç»“æ„"></a>APKåŒ…ç»“æ„</h2><table><thead><tr><th>Filename</th><th>Property</th></tr></thead><tbody><tr><td>assets</td><td>é™æ€èµ„æºï¼ˆå›¾ç‰‡ï¼Œé…ç½®æ–‡ä»¶ï¼Œhtml5ç¦»çº¿èµ„æºï¼‰ä»»æ„æ·±åº¦å­ç›®å½•</td></tr><tr><td>res</td><td>ç¨‹åºèµ„æºï¼ˆå›¾ç‰‡ï¼Œå›¾æ ‡ï¼Œå­—ç¬¦ä¸²ï¼‰æ‹¥æœ‰å¯¹åº”èµ„æºidï¼Œå…³è”ä»£ç R.java</td></tr><tr><td>lib</td><td>ä¾èµ–åº“ï¼ˆå½“å‰appç”¨åˆ°çš„soï¼‰</td></tr><tr><td>META-INF</td><td>è¯ä¹¦ç­¾åæ–‡ä»¶</td></tr><tr><td>.dex</td><td>å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ–¹æ³•æ•°&gt;2Â¹â¶æ—¶åˆ†åŒ…ï¼‰</td></tr><tr><td>AndroidManifest.xml</td><td>é¡¹ç›®çš„ç³»ç»Ÿæ¸…å•ï¼ˆé…ç½®ã€å››å¤§ç»„ä»¶çš„å£°æ˜ï¼‰</td></tr><tr><td>resources.arsc</td><td>èµ„æºç´¢å¼•è¡¨</td></tr></tbody></table><h2 id="Androidæ‰“åŒ…æµç¨‹"><a href="#Androidæ‰“åŒ…æµç¨‹" class="headerlink" title="Androidæ‰“åŒ…æµç¨‹"></a>Androidæ‰“åŒ…æµç¨‹</h2><p><img src="https://z3.ax1x.com/2021/03/25/6LmyL9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LmyL9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:56%;" /><img src="https://z3.ax1x.com/2021/03/25/6LmrM4.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LmrM4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:50%;" /></p><p>1.èµ„æºâ†’æºç </p><p>2.æ¥å£â†’æºç </p><p>3.æºç â†’å­—èŠ‚ç </p><p>4.å­—èŠ‚ç â†’å¯æ‰§è¡Œ</p><p>5.å¯æ‰§è¡Œâ†’apk</p><p>6.apkç­¾å</p><p>7.apkå¯¹é½å‹ç¼©</p><h2 id="APKå®‰è£…æµç¨‹"><a href="#APKå®‰è£…æµç¨‹" class="headerlink" title="APKå®‰è£…æµç¨‹"></a>APKå®‰è£…æµç¨‹</h2><p><img src="https://z3.ax1x.com/2021/03/25/6LmBzF.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LmBzF.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>1.åœ¨/data/appåˆ›å»ºä»¥apkåŒ…åå‘½åçš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†apkè§£å‹è‡³æ­¤</p><p>2.åœ¨/data/dataåˆ›å»ºä»¥apkåŒ…åå‘½åçš„æ–‡ä»¶å¤¹ï¼Œè§£æAndroidManifest.xmlå¹¶ä¸Šè¿°æ–‡ä»¶å¤¹å†™å…¥åº”ç”¨æ•°æ®</p><p>3.ä¼˜åŒ–dexæ–‡ä»¶ï¼Œä¿å­˜äºâ€/data/dalvik-cache/profiles/â€œ+apkåŒ…å</p><h2 id="è™šæ‹Ÿæœº"><a href="#è™šæ‹Ÿæœº" class="headerlink" title="è™šæ‹Ÿæœº"></a>è™šæ‹Ÿæœº</h2><table><thead><tr><th>ç±»å‹</th><th>è¿è¡Œ</th><th>æœºåˆ¶</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>javaè™šæ‹Ÿæœº</td><td>Javaå­—èŠ‚ç (.class)</td><td>ç•¥</td><td>åŸºäºæ ˆæ¶æ„</td></tr><tr><td>Dalvikè™šæ‹Ÿæœº</td><td>DEXå­—èŠ‚ç ï¼ˆ.odexï¼‰</td><td>jitç¼–è¯‘æœºåˆ¶</td><td>åŸºäºå¯„å­˜å™¨æ¶æ„ï¼ˆâ‰¤Android 5.0ï¼‰</td></tr><tr><td>ARTè™šæ‹Ÿæœº</td><td>DEXå­—èŠ‚ç ï¼ˆ.oatï¼‰</td><td>aotç¼–è¯‘æœºåˆ¶</td><td>åŸºäºå¯„å­˜å™¨æ¶æ„ï¼ˆ&gt;Android 5.0ï¼‰</td></tr></tbody></table><p><img src="https://z3.ax1x.com/2021/03/25/6LmssJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6LmssJ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="Androidå››å¤§ç»„ä»¶"><a href="#Androidå››å¤§ç»„ä»¶" class="headerlink" title="Androidå››å¤§ç»„ä»¶"></a>Androidå››å¤§ç»„ä»¶</h2><h3 id="å››å¤§ç»„ä»¶"><a href="#å››å¤§ç»„ä»¶" class="headerlink" title="å››å¤§ç»„ä»¶"></a>å››å¤§ç»„ä»¶</h3><table><thead><tr><th>Name</th><th align="center">What for</th></tr></thead><tbody><tr><td>æ´»åŠ¨(Activity)</td><td align="center">è¡¨ç°åŠŸèƒ½ï¼Œå¯è§†åŒ–çš„æŒ‡ä»¤æ“ä½œçª—å£</td></tr><tr><td>æœåŠ¡(Services)</td><td align="center">é•¿æœŸåå°æ‰§è¡Œï¼Œæ— äº¤äº’</td></tr><tr><td>å¹¿æ’­æ¥æ”¶è€…(Broadcast Recive)</td><td align="center">æ¥æ”¶å…¶ä»–åº”ç”¨ç¨‹åºçš„å¹¿æ’­ä¿¡æ¯</td></tr><tr><td>å†…å®¹æä¾›è€…(Content Provider)</td><td align="center">æ•°æ®é›†ï¼Œç”±å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«ä½¿ç”¨</td></tr></tbody></table><h2 id="Activityç”Ÿå‘½å‘¨æœŸ"><a href="#Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityç”Ÿå‘½å‘¨æœŸ"></a>Activityç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://z3.ax1x.com/2021/03/25/6Lm0RU.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/03/25/6Lm0RU.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      
        <tags>
            
            <tag> AndroidRe </tag>
            
            <tag> Summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android Re</title>
      <link href="2020/10/30/Android_Re/"/>
      <url>2020/10/30/Android_Re/</url>
      
        <content type="html"><![CDATA[<p>â€‹        å®‰å“é€†å‘å…¥é—¨å…¥é—¨ã€‚<span id="more"></span>æœ€è¿‘å¯ç®—å¼€å§‹å­¦å®‰å“é€†å‘äº†ï¼Œå…ˆåˆ·åˆ·jarvis ojä¸Šçš„é¢˜åº·åº·ã€‚</p><h2 id="0x00-Smail"><a href="#0x00-Smail" class="headerlink" title="0x00 . Smail"></a>0x00 . Smail</h2><p>â€‹        é¢˜ç›®åªç»™äº†ä¸€ä¸ª.smailæ–‡ä»¶ã€‚smailæ˜¯Davlikè™šæ‹Ÿæœºçš„å¯„å­˜å™¨è¯­è¨€ï¼Œç›¸å½“äºpcå¹³å°çš„æ±‡ç¼–è¯­è¨€ï¼Œå¯ä»¥çœ‹å‡ºä¸ªå¤§æ¦‚é€»è¾‘ã€‚</p><p>â€‹        ä¸è¿‡å½“ç„¶å¯ä»¥å€ŸåŠ©<strong>Smail2java</strong>å·¥å…·ï¼Œå°†å…¶è½¬æ¢æˆ.javaæ–‡ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20201102214537.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20201102214537.png" srcset="data:image/png;base64,iVBORw0KGgoAA